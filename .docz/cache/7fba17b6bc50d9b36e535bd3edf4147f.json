{"remainingRequest":"F:\\slate\\easteduCompoents\\node_modules\\thread-loader\\dist\\cjs.js??ref--11-1!F:\\slate\\easteduCompoents\\node_modules\\docz-core\\node_modules\\babel-loader\\lib\\index.js??ref--11-2!F:\\slate\\easteduCompoents\\node_modules\\source-map-loader\\index.js!F:\\slate\\easteduCompoents\\src\\QuestionEditor\\editor\\richtext.tsx","dependencies":[{"path":"F:\\slate\\easteduCompoents\\src\\QuestionEditor\\editor\\richtext.tsx","mtime":1611715909166},{"path":"F:\\slate\\easteduCompoents\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1611297672593},{"path":"F:\\slate\\easteduCompoents\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1611297676370},{"path":"F:\\slate\\easteduCompoents\\node_modules\\docz-core\\node_modules\\babel-loader\\lib\\index.js","mtime":1611297672218},{"path":"F:\\slate\\easteduCompoents\\node_modules\\source-map-loader\\index.js","mtime":1599723087186}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9vYmplY3RTcHJlYWQgZnJvbSAiRjpcXHNsYXRlXFxlYXN0ZWR1Q29tcG9lbnRzXFxub2RlX21vZHVsZXNcXGJhYmVsLXByZXNldC1yZWFjdC1hcHBcXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL29iamVjdFNwcmVhZDIiOwppbXBvcnQgX3NsaWNlZFRvQXJyYXkgZnJvbSAiRjpcXHNsYXRlXFxlYXN0ZWR1Q29tcG9lbnRzXFxub2RlX21vZHVsZXNcXGJhYmVsLXByZXNldC1yZWFjdC1hcHBcXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lL2hlbHBlcnMvZXNtL3NsaWNlZFRvQXJyYXkiOwoKdmFyIF90aGlzID0gdGhpcywKICAgIF9qc3hGaWxlTmFtZSA9ICJGOlxcc2xhdGVcXGVhc3RlZHVDb21wb2VudHNcXHNyY1xcUXVlc3Rpb25FZGl0b3JcXGVkaXRvclxccmljaHRleHQudHN4IjsKCihmdW5jdGlvbiAoKSB7CiAgdmFyIGVudGVyTW9kdWxlID0gdHlwZW9mIHJlYWN0SG90TG9hZGVyR2xvYmFsICE9PSAndW5kZWZpbmVkJyA/IHJlYWN0SG90TG9hZGVyR2xvYmFsLmVudGVyTW9kdWxlIDogdW5kZWZpbmVkOwogIGVudGVyTW9kdWxlICYmIGVudGVyTW9kdWxlKG1vZHVsZSk7Cn0pKCk7Cgp2YXIgX19zaWduYXR1cmVfXyA9IHR5cGVvZiByZWFjdEhvdExvYWRlckdsb2JhbCAhPT0gJ3VuZGVmaW5lZCcgPyByZWFjdEhvdExvYWRlckdsb2JhbFsiZGVmYXVsdCJdLnNpZ25hdHVyZSA6IGZ1bmN0aW9uIChhKSB7CiAgcmV0dXJuIGE7Cn07CgovLyBAdHMtaWdub3JlCmltcG9ydCBSZWFjdCwgeyB1c2VDYWxsYmFjaywgdXNlTWVtbywgdXNlU3RhdGUsIHVzZUVmZmVjdCwgdXNlUmVmIH0gZnJvbSAncmVhY3QnOwppbXBvcnQgaXNIb3RrZXkgZnJvbSAnaXMtaG90a2V5JzsKaW1wb3J0IHsgRWRpdGFibGUsIHdpdGhSZWFjdCwgU2xhdGUgfSBmcm9tICdzbGF0ZS1yZWFjdCc7CmltcG9ydCB7IFRleHQgfSBmcm9tICdzbGF0ZSc7CmltcG9ydCB7IEVsZW1lbnQsIExlYWYsIE1hcmtJY29uLCBNYXJrU3Vic2NyaXB0LCBNYXJrVmVydEFsaWduLCBNYXJrVGV4dEluZGVudCwgTWFya1dvcmRTcGFjZSwgU3ltYm9sLCBNYXJrSW5zZXJ0Rm9ybXVsYSwgTWFya0FsaWdubWVudCwgVW5vcmRlcmVkU29ydGluZywgT3JkZXJTb3J0aW5nLCBNYXJrQ29sb3IsIE1hcmtGb250LCBNYXJrRm9ybXVsYUVkaXRvciB9IGZyb20gJy4vcmljaHRleHREZXRhaWwnOwppbXBvcnQgeyBib2xkLCBjZW50ZXJBbGlnbm1lbnQsIGRpc29yZGVyLCBJdGFsaWMsIGxlZnRBbGlnbm1lbnQsIG9yZGVyLCBwb2ludCwgcmlnaHRBbGlnbm1lbnQsIHN0cmlrZW91dCwgc3Vic2NyaXB0LCBzdXBlcnNjcmlwdCwgdGV4dEluZGVudCwgdW5kZXJsaW5lLCB3b3Jkc3BhY2UsIGxpbmVTcGFjZSB9IGZyb20gJy4vdG9vbGJhckljb24nOwppbXBvcnQgeyBUZXh0SW5kZW50TGlzdCwgTGluZVNwYWNlTGlzdCwgTGlzdFdvcmRTcGFjZSwgZm9udFNpemVMaXN0LCBmb250TGlzdCwgZm9udE9iaiwgZm9udFNpemVPYmosIHNob3dNYXRoSmF4IH0gZnJvbSAnLi9jbGllbnQnOwppbXBvcnQgeyBFZGl0b3IsIE9wZXJhdGlvbiwgVHJhbnNmb3JtcywgTm9kZSwgY3JlYXRlRWRpdG9yLCBQYXRoIH0gZnJvbSAnc2xhdGUnOwppbXBvcnQgeyB3aXRoSGlzdG9yeSwgSGlzdG9yeUVkaXRvciB9IGZyb20gJ3NsYXRlLWhpc3RvcnknOwppbXBvcnQgeyBUb29sYmFyIH0gZnJvbSAnLi9jb21wb25lbnRzJzsKaW1wb3J0IEZvcm11bGFFZGl0b3IgZnJvbSAnLi9jb21wb25lbnRzL0Zvcm11bGFFZGl0b3InOwppbXBvcnQgJy4vcmljaHRleHQubGVzcyc7CmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7IC8vIGltcG9ydCB7IFRpcHMgfSBmcm9tICcuLi8uLi9jb21wb25lbnRzL2luZGV4JzsKCmltcG9ydCB7IFRpcHMgfSBmcm9tICcuLi8uLi9NZXNzYWdlVGlwcy9pbmRleCc7CmltcG9ydCBVcGxvYWRGaWxlIGZyb20gJy4vY29tcG9uZW50cy9VcGxvYWRGaWxlJzsKCnZhciBSaWNoVGV4dCA9IGZ1bmN0aW9uIFJpY2hUZXh0KHByb3BzKSB7CiAgdmFyIF91c2VTdGF0ZSA9IHVzZVN0YXRlKHByb3BzLnZhbHVlKSwKICAgICAgX3VzZVN0YXRlMiA9IF9zbGljZWRUb0FycmF5KF91c2VTdGF0ZSwgMiksCiAgICAgIHZhbHVlID0gX3VzZVN0YXRlMlswXSwKICAgICAgc2V0VmFsdWUgPSBfdXNlU3RhdGUyWzFdOwoKICB2YXIgX3VzZVN0YXRlMyA9IHVzZVN0YXRlKGZhbHNlKSwKICAgICAgX3VzZVN0YXRlNCA9IF9zbGljZWRUb0FycmF5KF91c2VTdGF0ZTMsIDIpLAogICAgICBpc0ZvY3VzZSA9IF91c2VTdGF0ZTRbMF0sCiAgICAgIHNldElzRm9jdXNlID0gX3VzZVN0YXRlNFsxXTsKCiAgdmFyIF91c2VTdGF0ZTUgPSB1c2VTdGF0ZShmYWxzZSksCiAgICAgIF91c2VTdGF0ZTYgPSBfc2xpY2VkVG9BcnJheShfdXNlU3RhdGU1LCAyKSwKICAgICAgaXNTZWxlY3Rpb24gPSBfdXNlU3RhdGU2WzBdLAogICAgICBzZXRJc1NlbGVjdGlvbiA9IF91c2VTdGF0ZTZbMV07CgogIHZhciBfdXNlU3RhdGU3ID0gdXNlU3RhdGUobnVsbCksCiAgICAgIF91c2VTdGF0ZTggPSBfc2xpY2VkVG9BcnJheShfdXNlU3RhdGU3LCAyKSwKICAgICAgZm9ybXVsYSA9IF91c2VTdGF0ZThbMF0sCiAgICAgIHNldEZvcm11bGEgPSBfdXNlU3RhdGU4WzFdOwoKICB2YXIgX3VzZVN0YXRlOSA9IHVzZVN0YXRlKG51bGwpLAogICAgICBfdXNlU3RhdGUxMCA9IF9zbGljZWRUb0FycmF5KF91c2VTdGF0ZTksIDIpLAogICAgICBzZWxlY3Rpb24gPSBfdXNlU3RhdGUxMFswXSwKICAgICAgc2V0U2VsZWN0aW9uID0gX3VzZVN0YXRlMTBbMV07CgogIHZhciBfdXNlU3RhdGUxMSA9IHVzZVN0YXRlKHByb3BzLm1vZGFsUG9zaXRpb24pLAogICAgICBfdXNlU3RhdGUxMiA9IF9zbGljZWRUb0FycmF5KF91c2VTdGF0ZTExLCAyKSwKICAgICAgbW9kYWxQb3NpdGlvbiA9IF91c2VTdGF0ZTEyWzBdLAogICAgICBzZXRNb2RhbFBvc2l0aW9uID0gX3VzZVN0YXRlMTJbMV07CgogIHZhciBfdXNlU3RhdGUxMyA9IHVzZVN0YXRlKHByb3BzLm1vZGFsUG9zaXRpb25JbnNlcnRGb3JtdWxhKSwKICAgICAgX3VzZVN0YXRlMTQgPSBfc2xpY2VkVG9BcnJheShfdXNlU3RhdGUxMywgMiksCiAgICAgIG1vZGFsUG9zaXRpb25JbnNlcnRGb3JtdWxhID0gX3VzZVN0YXRlMTRbMF0sCiAgICAgIHNldE1vZGFsUG9zaXRpb25JbnNlcnRGb3JtdWxhID0gX3VzZVN0YXRlMTRbMV07CgogIHZhciBfdXNlU3RhdGUxNSA9IHVzZVN0YXRlKHByb3BzLmlzSW5Cb3gpLAogICAgICBfdXNlU3RhdGUxNiA9IF9zbGljZWRUb0FycmF5KF91c2VTdGF0ZTE1LCAyKSwKICAgICAgaXNJbkJveCA9IF91c2VTdGF0ZTE2WzBdLAogICAgICBzZXRJc0luQm94ID0gX3VzZVN0YXRlMTZbMV07CgogIHZhciBfdXNlU3RhdGUxNyA9IHVzZVN0YXRlKHByb3BzLnNlYXJjaCksCiAgICAgIF91c2VTdGF0ZTE4ID0gX3NsaWNlZFRvQXJyYXkoX3VzZVN0YXRlMTcsIDIpLAogICAgICBzZWFyY2ggPSBfdXNlU3RhdGUxOFswXSwKICAgICAgc2V0U2VhcmNoID0gX3VzZVN0YXRlMThbMV07CgogIHZhciBfdXNlU3RhdGUxOSA9IHVzZVN0YXRlKCfor7fovpPlhaXlhoXlrrknKSwKICAgICAgX3VzZVN0YXRlMjAgPSBfc2xpY2VkVG9BcnJheShfdXNlU3RhdGUxOSwgMiksCiAgICAgIHBsYWNlaG9sZGVyID0gX3VzZVN0YXRlMjBbMF0sCiAgICAgIHNldFBsYWNlaG9sZGVyID0gX3VzZVN0YXRlMjBbMV07IC8vIGNvbnN0IFtpbnNlcnRDb21wb3NpdGlvblRleHQsIHNldEluc2VydENvbXBvc2l0aW9uVGV4dF0gPSB1c2VTdGF0ZShmYWxzZSk7CgoKICB2YXIgZWRpdG9yUmVmID0gdXNlUmVmKCk7CiAgdmFyIHJlbmRlckVsZW1lbnQgPSB1c2VDYWxsYmFjayhmdW5jdGlvbiAocHJvcHMpIHsKICAgIHJldHVybiAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChFbGVtZW50LCBPYmplY3QuYXNzaWduKHt9LCBwcm9wcywgewogICAgICBfX3NlbGY6IF90aGlzLAogICAgICBfX3NvdXJjZTogewogICAgICAgIGZpbGVOYW1lOiBfanN4RmlsZU5hbWUsCiAgICAgICAgbGluZU51bWJlcjogMTAzLAogICAgICAgIGNvbHVtbk51bWJlcjogNDYKICAgICAgfQogICAgfSkpOwogIH0sIFtdKTsKCiAgdmFyIHJlbmRlckxlYWYgPSBmdW5jdGlvbiByZW5kZXJMZWFmKHByb3BzKSB7CiAgICByZXR1cm4gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoTGVhZiwgT2JqZWN0LmFzc2lnbih7fSwgcHJvcHMsIHsKICAgICAgX19zZWxmOiBfdGhpcywKICAgICAgX19zb3VyY2U6IHsKICAgICAgICBmaWxlTmFtZTogX2pzeEZpbGVOYW1lLAogICAgICAgIGxpbmVOdW1iZXI6IDEwNCwKICAgICAgICBjb2x1bW5OdW1iZXI6IDM4CiAgICAgIH0KICAgIH0pKTsKICB9OwoKICB2YXIgZWRpdG9yID0gdXNlTWVtbyhmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gd2l0aE1lbnRpb25zKHdpdGhIaXN0b3J5KHdpdGhSZWFjdChjcmVhdGVFZGl0b3IoKSkpLCBwcm9wcyk7CiAgfSwgW10pOyAvLyDlr7nluLjop4HplJnor6/nmoTlrZfmrrXov5vooYzmo4Dmn6UKCiAgdmFyIGRlY29yYXRlID0gdXNlQ2FsbGJhY2soZnVuY3Rpb24gKF9yZWYpIHsKICAgIHZhciBfcmVmMiA9IF9zbGljZWRUb0FycmF5KF9yZWYsIDIpLAogICAgICAgIG5vZGUgPSBfcmVmMlswXSwKICAgICAgICBwYXRoID0gX3JlZjJbMV07CgogICAgdmFyIG5ld1JhbmdlcyA9IFtdOwogICAgdmFyIGxlbiA9IHNlYXJjaC5sZW5ndGggIT09IDA7CgogICAgaWYgKGxlbiAmJiBUZXh0LmlzVGV4dChub2RlKSkgewogICAgICB2YXIgdGV4dCA9IG5vZGUudGV4dDsKICAgICAgc2VhcmNoLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0sIGluZGV4KSB7CiAgICAgICAgdmFyIHRleHRzID0gdGV4dDsKICAgICAgICB2YXIgbWFya0xlbiA9IGluZGV4ICsgMTsKICAgICAgICB2YXIgcmVwbGFjZVN0ciA9ICcqKic7CgogICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgbWFya0xlbjsgaisrKSB7CiAgICAgICAgICByZXBsYWNlU3RyICs9ICc+JzsKICAgICAgICB9CgogICAgICAgIDsKICAgICAgICByZXBsYWNlU3RyICs9ICcqKic7CiAgICAgICAgaXRlbS5mb3JFYWNoKGZ1bmN0aW9uIChlbCkgewogICAgICAgICAgaWYgKGVsICE9PSAnKycgJiYgZWwgIT09ICdbJyAmJiBlbCAhPT0gJygnICYmIGVsICE9PSAnKScgJiYgZWwgIT09ICddJykgewogICAgICAgICAgICB0ZXh0cyA9IHRleHRzLnJlcGxhY2UobmV3IFJlZ0V4cCgiIi5jb25jYXQoZWwpLCAnZycpLCByZXBsYWNlU3RyKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRleHRzID0gdGV4dHMucmVwbGFjZShuZXcgUmVnRXhwKCJcXCIuY29uY2F0KGVsKSwgJ2cnKSwgcmVwbGFjZVN0cik7CiAgICAgICAgICB9CiAgICAgICAgfSk7IC8vIOagh+iusOmrmOS6ruWtl+autQoKICAgICAgICB2YXIgcGFydHMgPSB0ZXh0cy5zcGxpdChyZXBsYWNlU3RyKTsKICAgICAgICB2YXIgb2Zmc2V0ID0gMDsKICAgICAgICBwYXJ0cy5mb3JFYWNoKGZ1bmN0aW9uIChwYXJ0LCBpKSB7CiAgICAgICAgICBpZiAocGFydFtpXSA9PT0gJycgJiYgaSA9PT0gMCkgewogICAgICAgICAgICBuZXdSYW5nZXMucHVzaCh7CiAgICAgICAgICAgICAgYW5jaG9yOiB7CiAgICAgICAgICAgICAgICBwYXRoOiBwYXRoLAogICAgICAgICAgICAgICAgb2Zmc2V0OiBvZmZzZXQKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGZvY3VzOiB7CiAgICAgICAgICAgICAgICBwYXRoOiBwYXRoLAogICAgICAgICAgICAgICAgb2Zmc2V0OiBvZmZzZXQgKyBtYXJrTGVuCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBoaWdobGlnaHQ6IHRydWUKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIG9mZnNldCA9IG9mZnNldCArIG1hcmtMZW47CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChpICE9PSAwKSB7CiAgICAgICAgICAgIG5ld1Jhbmdlcy5wdXNoKHsKICAgICAgICAgICAgICBhbmNob3I6IHsKICAgICAgICAgICAgICAgIHBhdGg6IHBhdGgsCiAgICAgICAgICAgICAgICBvZmZzZXQ6IG9mZnNldAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgZm9jdXM6IHsKICAgICAgICAgICAgICAgIHBhdGg6IHBhdGgsCiAgICAgICAgICAgICAgICBvZmZzZXQ6IG9mZnNldCArIG1hcmtMZW4KICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGhpZ2hsaWdodDogdHJ1ZQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgb2Zmc2V0ID0gb2Zmc2V0ICsgcGFydC5sZW5ndGggKyBtYXJrTGVuOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG9mZnNldCA9IG9mZnNldCArIHBhcnQubGVuZ3RoOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KCiAgICA7IC8vIOaOkuW6jwoKICAgIG5ld1Jhbmdlcy5zb3J0KGZ1bmN0aW9uIChwcmUsIG5leHQpIHsKICAgICAgaWYgKHByZS5hbmNob3IgJiYgbmV4dC5hbmNob3IpIHsKICAgICAgICB2YXIgZCA9IFBhdGguY29tcGFyZShwcmUuYW5jaG9yLnBhdGgsIG5leHQuYW5jaG9yLnBhdGgpOwoKICAgICAgICBpZiAoZCA9PT0gMCkgewogICAgICAgICAgcmV0dXJuIHByZS5hbmNob3Iub2Zmc2V0IC0gbmV4dC5hbmNob3Iub2Zmc2V0OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gZDsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0pOyAvLyDlvZLlubYKCiAgICB2YXIgZmluYWxSYW5nZXMgPSBuZXdSYW5nZXMucmVkdWNlKGZ1bmN0aW9uIChhY2MsIGl0ZW0xKSB7CiAgICAgIHZhciBsZW4gPSBhY2MubGVuZ3RoOwogICAgICB2YXIgaXRlbSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoaXRlbTEpKTsKCiAgICAgIGlmIChsZW4pIHsKICAgICAgICBpZiAoUGF0aC5jb21wYXJlKGFjY1tsZW4gLSAxXS5hbmNob3IucGF0aCwgaXRlbS5hbmNob3IucGF0aCkgPT09IDApIHsKICAgICAgICAgIGlmIChhY2NbbGVuIC0gMV0uZm9jdXMub2Zmc2V0ID09PSBpdGVtLmFuY2hvci5vZmZzZXQpIHsKICAgICAgICAgICAgLy8gIeWmguaenOaYr+i/nue7reeahHJhbmdl5L2N572uCiAgICAgICAgICAgIGFjY1tsZW4gLSAxXS5mb2N1cy5vZmZzZXQgPSBpdGVtLmZvY3VzLm9mZnNldDsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vICHpnZ7ov57nu63kvY3nva4KICAgICAgICAgICAgYWNjLnB1c2goaXRlbSk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8vIOi3qOWFg+e0oAogICAgICAgICAgYWNjLnB1c2goaXRlbSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIOesrOS4gOasoei/m+WFpQogICAgICAgIGFjYy5wdXNoKGl0ZW0pOwogICAgICB9CgogICAgICByZXR1cm4gYWNjOwogICAgfSwgW10pOwogICAgcmV0dXJuIGZpbmFsUmFuZ2VzOwogIH0sIFtzZWFyY2hdKTsKICB1c2VFZmZlY3QoZnVuY3Rpb24gKCkgewogICAgc2V0U2VhcmNoKHByb3BzLnNlYXJjaCk7CiAgfSwgW3Byb3BzLnNlYXJjaF0pOwoKICB2YXIgYWRkRGJsRXZlbnQgPSBmdW5jdGlvbiBhZGREYmxFdmVudChlKSB7CiAgICBpZiAobmF2aWdhdG9yLm9uTGluZSkgewogICAgICBzZXRTZWxlY3Rpb24oZWRpdG9yLnNlbGVjdGlvbik7CiAgICAgIHNldEZvcm11bGEoZ2V0TWF0aE1MKGUudGFyZ2V0KSk7CiAgICB9IGVsc2UgaWYgKGUudGFyZ2V0LmNsYXNzTmFtZSAmJiBlLnRhcmdldC5jbGFzc05hbWUuaW5kZXhPZignYnV0dG9uVGl0bGUnKSA9PT0gLTEpIHsKICAgICAgVGlwcy5vcGVuKHsKICAgICAgICBtZXNzYWdlOiAn572R57uc6ZSZ6K+v77yM6K+356iN5ZCO6YeN6K+VJywKICAgICAgICB0eXBlOiAnZmFpbCcKICAgICAgfSk7CiAgICB9CiAgfTsKCiAgdmFyIGdldE1hdGhNTCA9IGZ1bmN0aW9uIGdldE1hdGhNTChlbCkgewogICAgaWYgKGVsLmdldEF0dHJpYnV0ZSAmJiAoIWVsLmdldEF0dHJpYnV0ZSgnY2xhc3MnKSB8fCBlbC5nZXRBdHRyaWJ1dGUoJ2NsYXNzJykuaW5kZXhPZigncmljaEJveCcpIDwgMCkpIHsKICAgICAgaWYgKGVsLmdldEF0dHJpYnV0ZSgnY2xhc3MnKSAmJiBlbC5nZXRBdHRyaWJ1dGUoJ2NsYXNzJykuaW5kZXhPZignTWF0aEpheCcpICE9PSAtMSkgewogICAgICAgIHJldHVybiBlbC5nZXRBdHRyaWJ1dGUoJ2RhdGEtbWF0aG1sJyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIGdldE1hdGhNTChlbC5wYXJlbnROb2RlKTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgfTsKCiAgdXNlRWZmZWN0KGZ1bmN0aW9uICgpIHsKICAgIHNldElzSW5Cb3gocHJvcHMuaXNJbkJveCk7CiAgfSwgW3Byb3BzLmlzSW5Cb3hdKTsKICB1c2VFZmZlY3QoZnVuY3Rpb24gKCkgewogICAgc2V0VmFsdWUocHJvcHMudmFsdWUpOwogICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBjdXJyZW50ID0gZWRpdG9yUmVmLmN1cnJlbnQ7CiAgICAgIGN1cnJlbnQgJiYgY3VycmVudC5hZGRFdmVudExpc3RlbmVyKCdkYmxjbGljaycsIGFkZERibEV2ZW50KTsKICAgICAgcmV0dXJuIGZ1bmN0aW9uIGNsZWFudXAoKSB7CiAgICAgICAgY3VycmVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdkYmxjbGljaycsIGFkZERibEV2ZW50KTsKICAgICAgfTsKICAgIH0sIDApOwogIH0sIFtwcm9wcy5pc0ZpbGxlZF0pOwogIHVzZUVmZmVjdChmdW5jdGlvbiAoKSB7CiAgICBzZXRNb2RhbFBvc2l0aW9uKHByb3BzLm1vZGFsUG9zaXRpb24pOwogIH0sIFtKU09OLnN0cmluZ2lmeShwcm9wcy5tb2RhbFBvc2l0aW9uKV0pOwogIHVzZUVmZmVjdChmdW5jdGlvbiAoKSB7CiAgICBzZXRNb2RhbFBvc2l0aW9uSW5zZXJ0Rm9ybXVsYShwcm9wcy5tb2RhbFBvc2l0aW9uSW5zZXJ0Rm9ybXVsYSk7CiAgfSwgW0pTT04uc3RyaW5naWZ5KHByb3BzLm1vZGFsUG9zaXRpb25JbnNlcnRGb3JtdWxhKV0pOwoKICBmdW5jdGlvbiBpc1NlbGVjdGlvbnMoKSB7CiAgICB2YXIgc2VsZWN0aW9uID0gZWRpdG9yLnNlbGVjdGlvbjsKCiAgICBpZiAoc2VsZWN0aW9uICYmIHNlbGVjdGlvbi5hbmNob3IgJiYgc2VsZWN0aW9uLmZvY3VzICYmIEpTT04uc3RyaW5naWZ5KHNlbGVjdGlvbi5hbmNob3IucGF0aCkgIT09IEpTT04uc3RyaW5naWZ5KHNlbGVjdGlvbi5mb2N1cy5wYXRoKSkgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIHVwZGF0ZUZvcm11bGEoZm9ybXVsYSkgewogICAgLy8gVE9ETzog5o+S5YWl5YWs5byP5Y+v6IO95a2Y5Zyo6Zeu6aKY6ZyA6KaB5ZCO57ut5LyY5YyWCiAgICBpZiAoZm9ybXVsYSkgewogICAgICAvLyBAdHMtaWdub3JlCiAgICAgIFRyYW5zZm9ybXMuc2V0U2VsZWN0aW9uKGVkaXRvciwgc2VsZWN0aW9uKTsKICAgICAgdmFyIHRhZzsKCiAgICAgIChmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGNoaWxkcmVuID0gZWRpdG9yOyAvLyBAdHMtaWdub3JlCgogICAgICAgIHZhciBfcGF0aCA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoc2VsZWN0aW9uLmFuY2hvci5wYXRoKSk7CgogICAgICAgIF9wYXRoLnNwbGljZSgtMik7CgogICAgICAgIF9wYXRoLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgICAgY2hpbGRyZW4gPSBjaGlsZHJlbi5jaGlsZHJlbltrZXldOwogICAgICAgIH0pOyAvLyBAdHMtaWdub3JlCgoKICAgICAgICB0YWcgPSBjaGlsZHJlbi5jaGlsZHJlbltzZWxlY3Rpb24uYW5jaG9yLnBhdGhbc2VsZWN0aW9uLmFuY2hvci5wYXRoLmxlbmd0aCAtIDJdXS50YWc7CiAgICAgIH0pKCk7IC8vIEB0cy1pZ25vcmUKCgogICAgICBUcmFuc2Zvcm1zLmluc2VydE5vZGVzKGVkaXRvciwgewogICAgICAgIHR5cGU6ICdtZW50aW9uJywKICAgICAgICBtZWRpYVR5cGU6ICdGT1JNVUxBJywKICAgICAgICBjaGFyYWN0ZXI6IGZvcm11bGEsCiAgICAgICAgdGFnOiBTdHJpbmcoTWF0aC5yYW5kb20oKSkucmVwbGFjZSgnXC4nLCAnJyksCiAgICAgICAgY2hpbGRyZW46IFt7CiAgICAgICAgICB0ZXh0OiAnICcsCiAgICAgICAgICBtYXJrOiBbXQogICAgICAgIH1dCiAgICAgIH0sIHsKICAgICAgICAvLyBAdHMtaWdub3JlCiAgICAgICAgYXQ6IHNlbGVjdGlvbgogICAgICB9KTsKICAgICAgdmFyIG5ld1NlbGVjdGlvbiA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoc2VsZWN0aW9uKSk7CgogICAgICAoZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBjaGlsZHJlbiA9IGVkaXRvcjsgLy8gQHRzLWlnbm9yZQoKICAgICAgICB2YXIgX3BhdGggPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHNlbGVjdGlvbi5hbmNob3IucGF0aCkpOwoKICAgICAgICBfcGF0aC5zcGxpY2UoLTIpOwoKICAgICAgICBfcGF0aC5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICAgIGNoaWxkcmVuID0gY2hpbGRyZW4uY2hpbGRyZW5ba2V5XTsKICAgICAgICB9KTsKCiAgICAgICAgY2hpbGRyZW4uY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoY2hpbGQsIGluZGV4KSB7CiAgICAgICAgICBpZiAoY2hpbGQudGFnID09PSB0YWcpIHsKICAgICAgICAgICAgbmV3U2VsZWN0aW9uLmFuY2hvci5wYXRoW25ld1NlbGVjdGlvbi5hbmNob3IucGF0aC5sZW5ndGggLSAyXSA9IGluZGV4OwogICAgICAgICAgICBuZXdTZWxlY3Rpb24uZm9jdXMucGF0aFtuZXdTZWxlY3Rpb24uZm9jdXMucGF0aC5sZW5ndGggLSAyXSA9IGluZGV4OwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9KSgpOwoKICAgICAgVHJhbnNmb3Jtc1siZGVsZXRlIl0oZWRpdG9yLCB7CiAgICAgICAgYXQ6IG5ld1NlbGVjdGlvbgogICAgICB9KTsKICAgIH0KCiAgICBzZXRTZWxlY3Rpb24obnVsbCk7CiAgICBzZXRGb3JtdWxhKG51bGwpOwogICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgIHNob3dNYXRoSmF4KHRydWUpOwogICAgfSwgMCk7CiAgfSAvLyBAdHMtaWdub3JlCgoKICByZXR1cm4gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsKICAgIC8vIEB0cy1pZ25vcmUKICAgIHJlZjogZWRpdG9yUmVmLAogICAgY2xhc3NOYW1lOiAncmljaEJveCcuY29uY2F0KCIgIiwgaXNGb2N1c2UgPyAnaXNDaG9vc2UnIDogJycpLAogICAgX19zZWxmOiBfdGhpcywKICAgIF9fc291cmNlOiB7CiAgICAgIGZpbGVOYW1lOiBfanN4RmlsZU5hbWUsCiAgICAgIGxpbmVOdW1iZXI6IDM0MywKICAgICAgY29sdW1uTnVtYmVyOiA1CiAgICB9CiAgfSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoU2xhdGUsIHsKICAgIGVkaXRvcjogZWRpdG9yLAogICAgdmFsdWU6IHZhbHVlLAogICAgb25DaGFuZ2U6IGZ1bmN0aW9uIG9uQ2hhbmdlKGUpIHsKICAgICAgLy8gY29uc3QgeyBzZWxlY3Rpb24gfSA9IGVkaXRvcjsKICAgICAgLy8gc2V0VmFsdWUoZSk7CiAgICAgIHZhciBlbGVtZW50ID0gW107CgogICAgICBpZiAoZS5sZW5ndGggPT09IDEgJiYgZVswXS5jaGlsZHJlbi5sZW5ndGggPT09IDEgJiYgZVswXS5jaGlsZHJlblswXS50ZXh0ID09PSAnJyAmJiAhZVswXS5jaGlsZHJlblswXS5pc0FkZCkgewogICAgICAgIGVsZW1lbnQgPSBbewogICAgICAgICAgY2hpbGRyZW46IFt7CiAgICAgICAgICAgIHRleHQ6ICcnCiAgICAgICAgICB9XSwKICAgICAgICAgIHN0eWxlczogW10sCiAgICAgICAgICB0eXBlOiAnTGVmdCcKICAgICAgICB9XTsKICAgICAgfSBlbHNlIGlmIChlLmxlbmd0aCAmJiBlWzBdLk51bWJlcmVkTGlzdCkgewogICAgICAgIGlmIChlLmxlbmd0aCA9PT0gMSAmJiBlWzBdLmNoaWxkcmVuLmxlbmd0aCA9PT0gMSAmJiBlWzBdLmNoaWxkcmVuWzBdLmNoaWxkcmVuLmxlbmd0aCA9PT0gMSAmJiBlWzBdLmNoaWxkcmVuWzBdLmNoaWxkcmVuWzBdLnRleHQgPT09ICcnKSB7CiAgICAgICAgICBlbGVtZW50ID0gW3sKICAgICAgICAgICAgTnVtYmVyZWRMaXN0OiBlWzBdLk51bWJlcmVkTGlzdCwKICAgICAgICAgICAgY2hpbGRyZW46IFt7CiAgICAgICAgICAgICAgY2hpbGRyZW46IFt7CiAgICAgICAgICAgICAgICB0ZXh0OiAnJwogICAgICAgICAgICAgIH1dLAogICAgICAgICAgICAgIHN0eWxlczogW10sCiAgICAgICAgICAgICAgdHlwZTogJ0xlZnQnLAogICAgICAgICAgICAgIExpc3RJdGVtOiB0cnVlCiAgICAgICAgICAgIH1dCiAgICAgICAgICB9XTsKICAgICAgICB9IGVsc2UgaWYgKGVbMF0uY2hpbGRyZW5bMF0uY2hpbGRyZW5bMF0udGV4dCA9PT0gJycpIHsKICAgICAgICAgIGVsZW1lbnQgPSBfLmNsb25lRGVlcChlKTsKICAgICAgICAgIGVsZW1lbnRbMF0uY2hpbGRyZW5bMF0uTGlzdEl0ZW0gPSB0cnVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBlbGVtZW50ID0gZTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZWxlbWVudCA9IGU7CiAgICAgIH0KCiAgICAgIGlmICghZS5sZW5ndGgpIHsKICAgICAgICBlbGVtZW50ID0gW3sKICAgICAgICAgIGNoaWxkcmVuOiBbewogICAgICAgICAgICB0ZXh0OiAnJwogICAgICAgICAgfV0sCiAgICAgICAgICBzdHlsZXM6IFtdLAogICAgICAgICAgdHlwZTogJ0xlZnQnCiAgICAgICAgfV07CiAgICAgIH0KCiAgICAgIGlmIChKU09OLnN0cmluZ2lmeShlbGVtZW50KSAhPT0gSlNPTi5zdHJpbmdpZnkodmFsdWUpKSB7CiAgICAgICAgcHJvcHMuY2hhbmdlVmFsdWUoZWxlbWVudCk7CiAgICAgICAgc2V0U2VhcmNoKFtdKTsKICAgICAgfQoKICAgICAgc2V0VmFsdWUoZWxlbWVudCk7CiAgICAgIGNvbnNvbGUubG9nKCJSaWNoVGV4dCAtPiBlbGVtZW50IiwgZWxlbWVudCk7CiAgICB9LAogICAgX19zZWxmOiBfdGhpcywKICAgIF9fc291cmNlOiB7CiAgICAgIGZpbGVOYW1lOiBfanN4RmlsZU5hbWUsCiAgICAgIGxpbmVOdW1iZXI6IDM0OCwKICAgICAgY29sdW1uTnVtYmVyOiA3CiAgICB9CiAgfSwgaXNGb2N1c2UgfHwgcHJvcHMuaXNGaXN0UmljaCA/IC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7CiAgICBjbGFzc05hbWU6ICdUb29sYmFyJywKICAgIF9fc2VsZjogX3RoaXMsCiAgICBfX3NvdXJjZTogewogICAgICBmaWxlTmFtZTogX2pzeEZpbGVOYW1lLAogICAgICBsaW5lTnVtYmVyOiA0MjAsCiAgICAgIGNvbHVtbk51bWJlcjogNDIKICAgIH0KICB9LAogIC8qI19fUFVSRV9fKi8KICAvLyBAdHMtaWdub3JlCiAgUmVhY3QuY3JlYXRlRWxlbWVudChUb29sYmFyLCB7CiAgICBfX3NlbGY6IF90aGlzLAogICAgX19zb3VyY2U6IHsKICAgICAgZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwKICAgICAgbGluZU51bWJlcjogNDI1LAogICAgICBjb2x1bW5OdW1iZXI6IDE1CiAgICB9CiAgfSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoTWFya0ZvbnQsIHsKICAgIGZvcm1hdDogJ0ZvbnQnLAogICAgZm9udExpc3Q6IGZvbnRMaXN0LAogICAgZm9udE9iajogZm9udE9iaiwKICAgIHdpZHRoOiA5OCwKICAgIHRpdGxlOiAiXHU1QjU3XHU0RjUzIiwKICAgIF9fc2VsZjogX3RoaXMsCiAgICBfX3NvdXJjZTogewogICAgICBmaWxlTmFtZTogX2pzeEZpbGVOYW1lLAogICAgICBsaW5lTnVtYmVyOiA0MjYsCiAgICAgIGNvbHVtbk51bWJlcjogMTUKICAgIH0KICB9KSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoTWFya0ZvbnQsIHsKICAgIGZvcm1hdDogJ0ZvbnRTaXplJywKICAgIGZvbnRMaXN0OiBmb250U2l6ZUxpc3QsCiAgICBmb250T2JqOiBmb250U2l6ZU9iaiwKICAgIHdpZHRoOiA1NCwKICAgIHRpdGxlOiAiXHU1QjU3XHU1M0Y3IiwKICAgIF9fc2VsZjogX3RoaXMsCiAgICBfX3NvdXJjZTogewogICAgICBmaWxlTmFtZTogX2pzeEZpbGVOYW1lLAogICAgICBsaW5lTnVtYmVyOiA0MzMsCiAgICAgIGNvbHVtbk51bWJlcjogMTUKICAgIH0KICB9KSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoTWFya0ljb24sIHsKICAgIGZvcm1hdDogJ0JvbGQnLAogICAgaWNvbjogYm9sZCwKICAgIHRpdGxlOiAiXHU1MkEwXHU3Qzk3IiwKICAgIF9fc2VsZjogX3RoaXMsCiAgICBfX3NvdXJjZTogewogICAgICBmaWxlTmFtZTogX2pzeEZpbGVOYW1lLAogICAgICBsaW5lTnVtYmVyOiA0NDAsCiAgICAgIGNvbHVtbk51bWJlcjogMTUKICAgIH0KICB9KSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoTWFya0ljb24sIHsKICAgIGZvcm1hdDogJ0l0YWxpYycsCiAgICBpY29uOiBJdGFsaWMsCiAgICB0aXRsZTogIlx1NTAzRVx1NjU5QyIsCiAgICBfX3NlbGY6IF90aGlzLAogICAgX19zb3VyY2U6IHsKICAgICAgZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwKICAgICAgbGluZU51bWJlcjogNDQxLAogICAgICBjb2x1bW5OdW1iZXI6IDE1CiAgICB9CiAgfSksIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KE1hcmtTdWJzY3JpcHQsIHsKICAgIGZvcm1hdDogJ1VuZGVybGluZVNpbmdsZScsCiAgICBpY29uOiB1bmRlcmxpbmUsCiAgICB0aXRsZTogIlx1NEUwQlx1NTIxMlx1N0VCRiIsCiAgICBfX3NlbGY6IF90aGlzLAogICAgX19zb3VyY2U6IHsKICAgICAgZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwKICAgICAgbGluZU51bWJlcjogNDQyLAogICAgICBjb2x1bW5OdW1iZXI6IDE1CiAgICB9CiAgfSksIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KE1hcmtJY29uLCB7CiAgICBmb3JtYXQ6ICdTdHJpa2UnLAogICAgaWNvbjogc3RyaWtlb3V0LAogICAgdGl0bGU6ICJcdTUyMjBcdTk2NjRcdTdFQkYiLAogICAgX19zZWxmOiBfdGhpcywKICAgIF9fc291cmNlOiB7CiAgICAgIGZpbGVOYW1lOiBfanN4RmlsZU5hbWUsCiAgICAgIGxpbmVOdW1iZXI6IDQ0MywKICAgICAgY29sdW1uTnVtYmVyOiAxNQogICAgfQogIH0pLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChNYXJrVmVydEFsaWduLCB7CiAgICBmb3JtYXQ6ICdWZXJ0QWxpZ25TdWJzY3JpcHQnLAogICAgaWNvbjogc3Vic2NyaXB0LAogICAgdGl0bGU6ICJcdTRFMEJcdTY4MDciLAogICAgX19zZWxmOiBfdGhpcywKICAgIF9fc291cmNlOiB7CiAgICAgIGZpbGVOYW1lOiBfanN4RmlsZU5hbWUsCiAgICAgIGxpbmVOdW1iZXI6IDQ0NCwKICAgICAgY29sdW1uTnVtYmVyOiAxNQogICAgfQogIH0pLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChNYXJrVmVydEFsaWduLCB7CiAgICBmb3JtYXQ6ICdWZXJ0QWxpZ25TdXBlcnNjcmlwdCcsCiAgICBpY29uOiBzdXBlcnNjcmlwdCwKICAgIHRpdGxlOiAiXHU0RTBBXHU2ODA3IiwKICAgIF9fc2VsZjogX3RoaXMsCiAgICBfX3NvdXJjZTogewogICAgICBmaWxlTmFtZTogX2pzeEZpbGVOYW1lLAogICAgICBsaW5lTnVtYmVyOiA0NDUsCiAgICAgIGNvbHVtbk51bWJlcjogMTUKICAgIH0KICB9KSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoTWFya0ljb24sIHsKICAgIGZvcm1hdDogJ0VtcGhhc2lzRG90JywKICAgIGljb246IHBvaW50LAogICAgdGl0bGU6ICJcdTc3NDBcdTkxQ0RcdTVCNTciLAogICAgX19zZWxmOiBfdGhpcywKICAgIF9fc291cmNlOiB7CiAgICAgIGZpbGVOYW1lOiBfanN4RmlsZU5hbWUsCiAgICAgIGxpbmVOdW1iZXI6IDQ0NiwKICAgICAgY29sdW1uTnVtYmVyOiAxNQogICAgfQogIH0pLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChNYXJrQ29sb3IsIHsKICAgIGZvcm1hdDogJ2NvbG9yJywKICAgIGljb246IG9yZGVyLAogICAgdGl0bGU6ICJcdTVCNTdcdTRGNTNcdTk4OUNcdTgyNzIiLAogICAgY29sb3I6IHByb3BzLmNvbG9yLAogICAgY2hhbmdlQ29sb3I6IGZ1bmN0aW9uIGNoYW5nZUNvbG9yKGUpIHsKICAgICAgcmV0dXJuIHByb3BzLmNoYW5nZUNvbG9yKGUpOwogICAgfSwKICAgIF9fc2VsZjogX3RoaXMsCiAgICBfX3NvdXJjZTogewogICAgICBmaWxlTmFtZTogX2pzeEZpbGVOYW1lLAogICAgICBsaW5lTnVtYmVyOiA0NDcsCiAgICAgIGNvbHVtbk51bWJlcjogMTUKICAgIH0KICB9KSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoInNwYW4iLCB7CiAgICBjbGFzc05hbWU6ICJTZXBhcmF0ZSIsCiAgICBfX3NlbGY6IF90aGlzLAogICAgX19zb3VyY2U6IHsKICAgICAgZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwKICAgICAgbGluZU51bWJlcjogNDU0LAogICAgICBjb2x1bW5OdW1iZXI6IDE1CiAgICB9CiAgfSksIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KE1hcmtBbGlnbm1lbnQsIHsKICAgIGZvcm1hdDogJ0xlZnQnLAogICAgaWNvbjogbGVmdEFsaWdubWVudCwKICAgIHRpdGxlOiAiXHU1REU2XHU1QkY5XHU5RjUwIiwKICAgIF9fc2VsZjogX3RoaXMsCiAgICBfX3NvdXJjZTogewogICAgICBmaWxlTmFtZTogX2pzeEZpbGVOYW1lLAogICAgICBsaW5lTnVtYmVyOiA0NTUsCiAgICAgIGNvbHVtbk51bWJlcjogMTUKICAgIH0KICB9KSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoTWFya0FsaWdubWVudCwgewogICAgZm9ybWF0OiAnQ2VudGVyJywKICAgIGljb246IGNlbnRlckFsaWdubWVudCwKICAgIHRpdGxlOiAiXHU1QzQ1XHU0RTJEXHU1QkY5XHU5RjUwIiwKICAgIF9fc2VsZjogX3RoaXMsCiAgICBfX3NvdXJjZTogewogICAgICBmaWxlTmFtZTogX2pzeEZpbGVOYW1lLAogICAgICBsaW5lTnVtYmVyOiA0NTYsCiAgICAgIGNvbHVtbk51bWJlcjogMTUKICAgIH0KICB9KSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoTWFya0FsaWdubWVudCwgewogICAgZm9ybWF0OiAnUmlnaHQnLAogICAgaWNvbjogcmlnaHRBbGlnbm1lbnQsCiAgICB0aXRsZTogIlx1NTNGM1x1NUJGOVx1OUY1MCIsCiAgICBfX3NlbGY6IF90aGlzLAogICAgX19zb3VyY2U6IHsKICAgICAgZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwKICAgICAgbGluZU51bWJlcjogNDU3LAogICAgICBjb2x1bW5OdW1iZXI6IDE1CiAgICB9CiAgfSksIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KE1hcmtXb3JkU3BhY2UsIHsKICAgIGZvcm1hdDogJ1dvcmRzcGFjZScsCiAgICBpY29uOiB3b3Jkc3BhY2UsCiAgICBpdGVtTGlzdDogTGlzdFdvcmRTcGFjZSwKICAgIHVuaXQ6ICJcdTVCNTdcdTdCMjYiLAogICAgdGl0bGU6ICJcdTVCNTdcdTk1RjRcdThEREQiLAogICAgX19zZWxmOiBfdGhpcywKICAgIF9fc291cmNlOiB7CiAgICAgIGZpbGVOYW1lOiBfanN4RmlsZU5hbWUsCiAgICAgIGxpbmVOdW1iZXI6IDQ1OCwKICAgICAgY29sdW1uTnVtYmVyOiAxNQogICAgfQogIH0pLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChNYXJrVGV4dEluZGVudCwgewogICAgZm9ybWF0OiAnTGluZVNwYWNlJywKICAgIGljb246IGxpbmVTcGFjZSwKICAgIGl0ZW1MaXN0OiBMaW5lU3BhY2VMaXN0LAogICAgdW5pdDogIlx1NTAwRCIsCiAgICB0aXRsZTogIlx1ODg0Q1x1NTQ4Q1x1NkJCNVx1ODQzRFx1OTVGNFx1OERERCIsCiAgICBfX3NlbGY6IF90aGlzLAogICAgX19zb3VyY2U6IHsKICAgICAgZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwKICAgICAgbGluZU51bWJlcjogNDY2LAogICAgICBjb2x1bW5OdW1iZXI6IDE1CiAgICB9CiAgfSksIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KE1hcmtUZXh0SW5kZW50LCB7CiAgICBmb3JtYXQ6ICdUZXh0SW5kZW50JywKICAgIGljb246IHRleHRJbmRlbnQsCiAgICBpdGVtTGlzdDogVGV4dEluZGVudExpc3QsCiAgICB1bml0OiAiXHU1QjU3XHU3QjI2IiwKICAgIHRpdGxlOiAiXHU5OTk2XHU4ODRDXHU3RjI5XHU4RkRCIiwKICAgIF9fc2VsZjogX3RoaXMsCiAgICBfX3NvdXJjZTogewogICAgICBmaWxlTmFtZTogX2pzeEZpbGVOYW1lLAogICAgICBsaW5lTnVtYmVyOiA0NzQsCiAgICAgIGNvbHVtbk51bWJlcjogMTUKICAgIH0KICB9KSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoVW5vcmRlcmVkU29ydGluZywgewogICAgZm9ybWF0OiAnTnVtYmVyZWRMaXN0JywKICAgIGljb246IGRpc29yZGVyLAogICAgdGl0bGU6ICJcdTY1RTBcdTVFOEZcdTUyMTdcdTg4NjgiLAogICAgX19zZWxmOiBfdGhpcywKICAgIF9fc291cmNlOiB7CiAgICAgIGZpbGVOYW1lOiBfanN4RmlsZU5hbWUsCiAgICAgIGxpbmVOdW1iZXI6IDQ4MiwKICAgICAgY29sdW1uTnVtYmVyOiAxNQogICAgfQogIH0pLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChPcmRlclNvcnRpbmcsIHsKICAgIGZvcm1hdDogJ051bWJlcmVkTGlzdCcsCiAgICBpY29uOiBvcmRlciwKICAgIHRpdGxlOiAiXHU2NzA5XHU1RThGXHU1MjE3XHU4ODY4IiwKICAgIHNvcnRGb3JtYXQ6IHByb3BzLnNvcnRGb3JtYXQsCiAgICBzZXRGb3JtYXQ6IHByb3BzLnNldEZvcm1hdCwKICAgIF9fc2VsZjogX3RoaXMsCiAgICBfX3NvdXJjZTogewogICAgICBmaWxlTmFtZTogX2pzeEZpbGVOYW1lLAogICAgICBsaW5lTnVtYmVyOiA0ODMsCiAgICAgIGNvbHVtbk51bWJlcjogMTUKICAgIH0KICB9KSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoInNwYW4iLCB7CiAgICBjbGFzc05hbWU6ICJTZXBhcmF0ZSIsCiAgICBfX3NlbGY6IF90aGlzLAogICAgX19zb3VyY2U6IHsKICAgICAgZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwKICAgICAgbGluZU51bWJlcjogNDkwLAogICAgICBjb2x1bW5OdW1iZXI6IDE1CiAgICB9CiAgfSksIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KE1hcmtJbnNlcnRGb3JtdWxhLCB7CiAgICB0aXRsZTogIlx1NEVDRVx1NTZGRVx1NzI0N1x1NjNEMlx1NTE2NVx1NTE2Q1x1NUYwRiIsCiAgICBpc0ZvY3VzZTogaXNGb2N1c2UgLy8gc2V0VmlzaWJsZT17cHJvcHMuc2V0VmlzaWJsZSAmJiBwcm9wcy5zZXRWaXNpYmxlfQogICAgLAogICAgbW9kYWxQb3NpdGlvbjogbW9kYWxQb3NpdGlvbkluc2VydEZvcm11bGEsCiAgICBwb3N0aW9uOiBmdW5jdGlvbiBwb3N0aW9uKGUpIHsKICAgICAgaWYgKGUgJiYgZS5pc0Nsb3NlTWVkb2FsKSB7CiAgICAgICAgc2V0SXNGb2N1c2UoZmFsc2UpOwogICAgICAgIGRlbGV0ZSBlLmlzQ2xvc2VNZWRvYWw7CiAgICAgIH0KCiAgICAgIHByb3BzLnBvc2l0aW9uSW5zZXJ0Rm9ybXVsYSAmJiBwcm9wcy5wb3NpdGlvbkluc2VydEZvcm11bGEoZSk7CiAgICB9LAogICAgY2hhbmdlRm9jdXNlOiBmdW5jdGlvbiBjaGFuZ2VGb2N1c2UoZSkgewogICAgICByZXR1cm4gc2V0SXNGb2N1c2UoZSk7CiAgICB9LAogICAgX19zZWxmOiBfdGhpcywKICAgIF9fc291cmNlOiB7CiAgICAgIGZpbGVOYW1lOiBfanN4RmlsZU5hbWUsCiAgICAgIGxpbmVOdW1iZXI6IDQ5MSwKICAgICAgY29sdW1uTnVtYmVyOiAxNQogICAgfQogIH0pLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChNYXJrRm9ybXVsYUVkaXRvciwgewogICAgdGl0bGU6ICJcdTYzRDJcdTUxNjVcdTUxNkNcdTVGMEYiLAogICAgaXNGb2N1c2U6IGlzRm9jdXNlIC8vIHNldFZpc2libGU9e3Byb3BzLnNldFZpc2libGUgJiYgcHJvcHMuc2V0VmlzaWJsZX0KICAgICwKICAgIG1vZGFsUG9zaXRpb246IG1vZGFsUG9zaXRpb25JbnNlcnRGb3JtdWxhLAogICAgcG9zdGlvbjogZnVuY3Rpb24gcG9zdGlvbihlKSB7CiAgICAgIGNvbnNvbGUubG9nKCdlPT09PT4nLCBlKTsKCiAgICAgIGlmIChlICYmIGUuaXNDbG9zZU1lZG9hbCkgewogICAgICAgIHNldElzRm9jdXNlKGZhbHNlKTsKICAgICAgICBkZWxldGUgZS5pc0Nsb3NlTWVkb2FsOwogICAgICB9CgogICAgICBwcm9wcy5wb3NpdGlvbkluc2VydEZvcm11bGEgJiYgcHJvcHMucG9zaXRpb25JbnNlcnRGb3JtdWxhKGUpOwogICAgfSwKICAgIGNoYW5nZUZvY3VzZTogZnVuY3Rpb24gY2hhbmdlRm9jdXNlKGUpIHsKICAgICAgcmV0dXJuIHNldElzRm9jdXNlKGUpOwogICAgfSwKICAgIF9fc2VsZjogX3RoaXMsCiAgICBfX3NvdXJjZTogewogICAgICBmaWxlTmFtZTogX2pzeEZpbGVOYW1lLAogICAgICBsaW5lTnVtYmVyOiA1MDUsCiAgICAgIGNvbHVtbk51bWJlcjogMTUKICAgIH0KICB9KSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoInNwYW4iLCB7CiAgICBjbGFzc05hbWU6ICJTZXBhcmF0ZSIsCiAgICBfX3NlbGY6IF90aGlzLAogICAgX19zb3VyY2U6IHsKICAgICAgZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwKICAgICAgbGluZU51bWJlcjogNTIyLAogICAgICBjb2x1bW5OdW1iZXI6IDE1CiAgICB9CiAgfSksIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KFN5bWJvbCwgewogICAgdGl0bGU6ICJcdTdCMjZcdTUzRjciLAogICAgaXNGb2N1c2U6IGlzRm9jdXNlLAogICAgc2V0VmlzaWJsZTogcHJvcHMuc2V0VmlzaWJsZSAmJiBwcm9wcy5zZXRWaXNpYmxlLAogICAgbW9kYWxQb3NpdGlvbjogbW9kYWxQb3NpdGlvbiwKICAgIHBvc3Rpb246IHByb3BzLnBvc3Rpb24gJiYgcHJvcHMucG9zdGlvbiwKICAgIF9fc2VsZjogX3RoaXMsCiAgICBfX3NvdXJjZTogewogICAgICBmaWxlTmFtZTogX2pzeEZpbGVOYW1lLAogICAgICBsaW5lTnVtYmVyOiA1MjMsCiAgICAgIGNvbHVtbk51bWJlcjogMTUKICAgIH0KICB9KSkpIDogJycsIGZvcm11bGEgPyAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChGb3JtdWxhRWRpdG9yLCB7CiAgICBmb3JtdWxhOiBmb3JtdWxhLAogICAgb25TdWJtaXQ6IGZ1bmN0aW9uIG9uU3VibWl0KGZvcm11bGEpIHsKICAgICAgdXBkYXRlRm9ybXVsYShmb3JtdWxhKTsKICAgIH0sCiAgICBfX3NlbGY6IF90aGlzLAogICAgX19zb3VyY2U6IHsKICAgICAgZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwKICAgICAgbGluZU51bWJlcjogNTM1LAogICAgICBjb2x1bW5OdW1iZXI6IDIxCiAgICB9CiAgfSkgOiAnJywgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoRWRpdGFibGUsIHsKICAgIGRlY29yYXRlOiBkZWNvcmF0ZSwKICAgIHJlbmRlckVsZW1lbnQ6IHJlbmRlckVsZW1lbnQsCiAgICByZW5kZXJMZWFmOiByZW5kZXJMZWFmLAogICAgcGxhY2Vob2xkZXI6IHBsYWNlaG9sZGVyLAogICAgc3R5bGU6IHsKICAgICAgbWluSGVpZ2h0OiBwcm9wcy5pc09wdGlvbiA/ICcxNHB4JyA6ICc2M3B4JwogICAgfSwKICAgIGF1dG9Gb2N1czogcHJvcHMuYXV0b0ZvY3VzID8gcHJvcHMuYXV0b0ZvY3VzIDogZmFsc2UsCiAgICBvbkZvY3VzOiBmdW5jdGlvbiBvbkZvY3VzKCkgewogICAgICBjb25zb2xlLmVycm9yKDEpOwogICAgICBzZXRJc0ZvY3VzZSh0cnVlKTsKICAgICAgcHJvcHMuaXNJbkJveCAmJiBwcm9wcy5pc0luQm94KHRydWUpOwogICAgfSwKICAgIG9uQmx1cjogZnVuY3Rpb24gb25CbHVyKCkgewogICAgICBjb25zb2xlLmVycm9yKDIpOwoKICAgICAgaWYgKCFtb2RhbFBvc2l0aW9uSW5zZXJ0Rm9ybXVsYS52aXNpYmxlIHx8IGlzSW5Cb3gpIHsKICAgICAgICBzZXRJc0ZvY3VzZShmYWxzZSk7CiAgICAgIH0KICAgIH0sCiAgICBvbk1vdXNlTW92ZTogZnVuY3Rpb24gb25Nb3VzZU1vdmUoKSB7CiAgICAgIGlmIChpc1NlbGVjdGlvbnMoKSkgewogICAgICAgIHNldElzU2VsZWN0aW9uKHRydWUpOwogICAgICB9IGVsc2UgewogICAgICAgIHNldElzU2VsZWN0aW9uKGZhbHNlKTsKICAgICAgfQogICAgfSwKICAgIG9uRE9NQmVmb3JlSW5wdXQ6IGZ1bmN0aW9uIG9uRE9NQmVmb3JlSW5wdXQoKSB7fSwKICAgIG9uSW5wdXQ6IGZ1bmN0aW9uIG9uSW5wdXQoKSB7CiAgICAgIGlmIChpc1NlbGVjdGlvbiB8fCBpc1NlbGVjdGlvbnMoKSkgewogICAgICAgIGVkaXRvci5kZWxldGVGcmFnbWVudCgpOwogICAgICAgIHNldElzU2VsZWN0aW9uKGZhbHNlKTsKICAgICAgfQogICAgfSwKICAgIG9uS2V5RG93bjogZnVuY3Rpb24gb25LZXlEb3duKGV2ZW50KSB7CiAgICAgIGlmIChldmVudC5rZXlDb2RlID09PSAxMyAmJiBwcm9wcy5pc29wdGlvbikgewogICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIH0KCiAgICAgIHZhciBzZWxlY3Rpb24gPSBlZGl0b3Iuc2VsZWN0aW9uOwoKICAgICAgaWYgKHNlbGVjdGlvbiAmJiBzZWxlY3Rpb24uYW5jaG9yLm9mZnNldCA9PT0gMCAmJiBzZWxlY3Rpb24uZm9jdXMub2Zmc2V0ICE9PSAwKSB7CiAgICAgICAgc2V0U2VhcmNoKCcnKTsKICAgICAgfQoKICAgICAgaWYgKGlzSG90a2V5KCdkZWxldGUnLCBldmVudCkgfHwgaXNIb3RrZXkoJ2JhY2tzcGFjZScsIGV2ZW50KSkgewogICAgICAgIGlmICghZWRpdG9yLnNlbGVjdGlvbikgcmV0dXJuIGZhbHNlOyAvLyAyMDIwLzA2LzIyIOS/ruaUuSDliKDpmaTkvJrmiqXplJkgZWRpdG9yLnNlbGVjdCA9PT0gbnVsbDsKCiAgICAgICAgdmFyIHBhdGggPSBlZGl0b3Iuc2VsZWN0aW9uICYmIGVkaXRvci5zZWxlY3Rpb24uYW5jaG9yLnBhdGg7CiAgICAgICAgdmFyIGIgPSBOb2RlLnBhcmVudChlZGl0b3IsIGVkaXRvci5zZWxlY3Rpb24uYW5jaG9yLnBhdGgpOyAvLyBFZGl0b3IucmVtb3ZlTWFyayhlZGl0b3IsICdCb2xkJyk7CgogICAgICAgIGlmIChwYXRoICYmIGIgJiYgYi50eXBlID09PSAnbWVudGlvbicpIHsKICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICBlZGl0b3IuZGVsZXRlQmFja3dhcmQoewogICAgICAgICAgICB1bml0OiAnY2hhcmFjdGVyJwogICAgICAgICAgfSk7CiAgICAgICAgfSAvLyDlpITnkIbpppbooYzmmK/mjpLluo/liJfooajnmoTml7blgJnvvIzmlbLlh7vlm57pgIDplK7ov5vooYzliKDpmaTmjpLluo/moLflvI8KCgogICAgICAgIGlmIChldmVudC5rZXlDb2RlID09PSA4KSB7CiAgICAgICAgICB2YXIgYSA9IE5vZGUuZ2V0KGVkaXRvciwgZWRpdG9yLnNlbGVjdGlvbi5hbmNob3IucGF0aCk7CgogICAgICAgICAgdmFyIF9iID0gTm9kZS5wYXJlbnQoZWRpdG9yLCBlZGl0b3Iuc2VsZWN0aW9uLmFuY2hvci5wYXRoKTsKCiAgICAgICAgICBpZiAoYS50ZXh0ID09PSAnJyAmJiBfYi5MaXN0SXRlbSAmJiBfYi5jaGlsZHJlbi5sZW5ndGggPT09IDEgJiYgZWRpdG9yLnNlbGVjdGlvbi5hbmNob3IucGF0aFswXSA9PT0gMCAmJiBlZGl0b3Iuc2VsZWN0aW9uLmFuY2hvci5wYXRoWzFdID09PSAwKSB7CiAgICAgICAgICAgIFRyYW5zZm9ybXMudW53cmFwTm9kZXMoZWRpdG9yLCB7CiAgICAgICAgICAgICAgLy8gQHRzLWlnbm9yZQogICAgICAgICAgICAgIG1hdGNoOiBmdW5jdGlvbiBtYXRjaChuKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gblsnTnVtYmVyZWRMaXN0J107CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBzcGxpdDogdHJ1ZQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgVHJhbnNmb3Jtcy5zZXROb2RlcyhlZGl0b3IsIHsKICAgICAgICAgICAgICAnTGlzdEl0ZW0nOiBmYWxzZQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHZhciBfc2VsZWN0aW9uID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShlZGl0b3Iuc2VsZWN0aW9uKSk7CgogICAgICAgIHZhciBjaGlsZHJlbiA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZWRpdG9yLmNoaWxkcmVuKSk7CgogICAgICAgIGlmIChKU09OLnN0cmluZ2lmeShfc2VsZWN0aW9uLmFuY2hvcikgIT09IEpTT04uc3RyaW5naWZ5KF9zZWxlY3Rpb24uZm9jdXMpICYmIF9zZWxlY3Rpb24uYW5jaG9yLnBhdGhbMV0gPT09IDAgJiYgX3NlbGVjdGlvbi5hbmNob3Iub2Zmc2V0ID09PSAwKSB7CiAgICAgICAgICAvLyBwYXRjaDog5Yik5pat5piv5ZCm5LuO5aS06YCJ5Yiw5bC+CiAgICAgICAgICBpZiAoX3NlbGVjdGlvbi5hbmNob3IucGF0aFswXSA9PT0gMCAmJiBfc2VsZWN0aW9uLmZvY3VzLnBhdGhbMF0gPT09IGNoaWxkcmVuLmxlbmd0aCAtIDEgJiYgX3NlbGVjdGlvbi5mb2N1cy5wYXRoWzFdID09PSBjaGlsZHJlbltjaGlsZHJlbi5sZW5ndGggLSAxXS5jaGlsZHJlbi5sZW5ndGggLSAxICYmIF9zZWxlY3Rpb24uZm9jdXMub2Zmc2V0ID09PSBjaGlsZHJlbltfc2VsZWN0aW9uLmZvY3VzLnBhdGhbMF1dLmNoaWxkcmVuW19zZWxlY3Rpb24uZm9jdXMucGF0aFsxXV0udGV4dC5sZW5ndGgpIHsKICAgICAgICAgICAgVHJhbnNmb3Jtcy5yZW1vdmVOb2RlcyhlZGl0b3IpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChldmVudC5rZXlDb2RlID09PSAyMjkpIHsKICAgICAgICB2YXIgX3BhdGgyID0gZWRpdG9yLnNlbGVjdGlvbiAmJiBlZGl0b3Iuc2VsZWN0aW9uLmFuY2hvci5wYXRoOwoKICAgICAgICBpZiAoaXNTZWxlY3Rpb24gfHwgaXNTZWxlY3Rpb25zKCkpIHsKICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICBlZGl0b3IuZGVsZXRlRnJhZ21lbnQoKTsKICAgICAgICAgIHNldElzU2VsZWN0aW9uKGZhbHNlKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoaXNIb3RrZXkoJ0NvbnRyb2wrWCcsIGV2ZW50KSB8fCBpc0hvdGtleSgnQ29tbWFuZCtYJywgZXZlbnQpKSB7CiAgICAgICAgLy8g5Zyo5Ymq5YiH55qE5pe25YCZ77yM5Yig6Zmk5Zu+54mHCiAgICAgICAgdmFyIF9zZWxlY3Rpb24yID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShlZGl0b3Iuc2VsZWN0aW9uKSk7CgogICAgICAgIHZhciBzZWxlY3Rpb25GcmFnbWVudCA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoTm9kZS5mcmFnbWVudChlZGl0b3IsIF9zZWxlY3Rpb24yKSkpOwoKICAgICAgICB2YXIgX2NoaWxkcmVuID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShlZGl0b3IuY2hpbGRyZW4pKTsKCiAgICAgICAgdmFyIGhhc0Zvcm11bGEgPSBzZWxlY3Rpb25GcmFnbWVudC5maWx0ZXIoZnVuY3Rpb24gKGZyYWdtZW50KSB7CiAgICAgICAgICByZXR1cm4gZnJhZ21lbnQuY2hpbGRyZW4uZmlsdGVyKGZ1bmN0aW9uIChjaGlsZCkgewogICAgICAgICAgICByZXR1cm4gY2hpbGQubWVkaWFUeXBlID09PSAnRk9STVVMQScgfHwgY2hpbGQubWVkaWFUeXBlID09PSAnSU1BR0UnOwogICAgICAgICAgfSkubGVuZ3RoOwogICAgICAgIH0pOwogICAgICAgIGNvbnNvbGUubG9nKGhhc0Zvcm11bGEpOwoKICAgICAgICBpZiAoaGFzRm9ybXVsYS5sZW5ndGgpIHsKICAgICAgICAgIGlmIChKU09OLnN0cmluZ2lmeShfc2VsZWN0aW9uMi5hbmNob3IpICE9PSBKU09OLnN0cmluZ2lmeShfc2VsZWN0aW9uMi5mb2N1cykgJiYgX3NlbGVjdGlvbjIuYW5jaG9yLnBhdGhbMV0gPT09IDAgJiYgX3NlbGVjdGlvbjIuYW5jaG9yLm9mZnNldCA9PT0gMCkgewogICAgICAgICAgICBUcmFuc2Zvcm1zLnJlbW92ZU5vZGVzKGVkaXRvciwgX3NlbGVjdGlvbjIpOyAvLyBwYXRjaDog5Yik5pat5piv5ZCm5LuO5aS06YCJ5Yiw5bC+CgogICAgICAgICAgICBpZiAoX3NlbGVjdGlvbjIuYW5jaG9yLnBhdGhbMF0gPT09IDAgJiYgX3NlbGVjdGlvbjIuZm9jdXMucGF0aFswXSA9PT0gX2NoaWxkcmVuLmxlbmd0aCAtIDEgJiYgX3NlbGVjdGlvbjIuZm9jdXMucGF0aFsxXSA9PT0gX2NoaWxkcmVuW19jaGlsZHJlbi5sZW5ndGggLSAxXS5jaGlsZHJlbi5sZW5ndGggLSAxICYmIF9zZWxlY3Rpb24yLmZvY3VzLm9mZnNldCA9PT0gX2NoaWxkcmVuW19zZWxlY3Rpb24yLmZvY3VzLnBhdGhbMF1dLmNoaWxkcmVuW19zZWxlY3Rpb24yLmZvY3VzLnBhdGhbMV1dLnRleHQubGVuZ3RoKSB7CiAgICAgICAgICAgICAgVHJhbnNmb3Jtcy5yZW1vdmVOb2RlcyhlZGl0b3IpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBUcmFuc2Zvcm1zWyJkZWxldGUiXShlZGl0b3IsIHsKICAgICAgICAgICAgICBhdDogX3NlbGVjdGlvbjIKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CgogICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgIHZhciBjbG9uZUFjdGl2ZUVsZW1lbnQgPSBKU09OLnN0cmluZ2lmeSh7CiAgICAgICAgICAgIGZyb21DdXQ6IHRydWUsCiAgICAgICAgICAgIGZyYWdtZW50OiBzZWxlY3Rpb25GcmFnbWVudAogICAgICAgICAgfSk7CiAgICAgICAgICB2YXIgY29weVRleHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY29weV90ZXh0Iik7CiAgICAgICAgICBjb3B5VGV4dC5pbm5lckhUTUwgPSBjbG9uZUFjdGl2ZUVsZW1lbnQ7CiAgICAgICAgICBjb3B5VGV4dC5yZWFkT25seSA9IGZhbHNlOwogICAgICAgICAgY29weVRleHQuc2VsZWN0KCk7CiAgICAgICAgICBjb3B5VGV4dC5zZXRTZWxlY3Rpb25SYW5nZSgwLCBjb3B5VGV4dC52YWx1ZS5sZW5ndGgpOwogICAgICAgICAgZG9jdW1lbnQuZXhlY0NvbW1hbmQoImNvcHkiKTsKICAgICAgICAgIGNvcHlUZXh0LnJlYWRPbmx5ID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBfX3NlbGY6IF90aGlzLAogICAgX19zb3VyY2U6IHsKICAgICAgZmlsZU5hbWU6IF9qc3hGaWxlTmFtZSwKICAgICAgbGluZU51bWJlcjogNTQwLAogICAgICBjb2x1bW5OdW1iZXI6IDkKICAgIH0KICB9KSkpOwp9OwoKX19zaWduYXR1cmVfXyhSaWNoVGV4dCwgInVzZVN0YXRle1t2YWx1ZSwgc2V0VmFsdWVdKHByb3BzLnZhbHVlKX1cbnVzZVN0YXRle1tpc0ZvY3VzZSwgc2V0SXNGb2N1c2VdKGZhbHNlKX1cbnVzZVN0YXRle1tpc1NlbGVjdGlvbiwgc2V0SXNTZWxlY3Rpb25dKGZhbHNlKX1cbnVzZVN0YXRle1tmb3JtdWxhLCBzZXRGb3JtdWxhXShudWxsKX1cbnVzZVN0YXRle1tzZWxlY3Rpb24sIHNldFNlbGVjdGlvbl0obnVsbCl9XG51c2VTdGF0ZXtbbW9kYWxQb3NpdGlvbiwgc2V0TW9kYWxQb3NpdGlvbl0ocHJvcHMubW9kYWxQb3NpdGlvbil9XG51c2VTdGF0ZXtbbW9kYWxQb3NpdGlvbkluc2VydEZvcm11bGEsIHNldE1vZGFsUG9zaXRpb25JbnNlcnRGb3JtdWxhXShwcm9wcy5tb2RhbFBvc2l0aW9uSW5zZXJ0Rm9ybXVsYSl9XG51c2VTdGF0ZXtbaXNJbkJveCwgc2V0SXNJbkJveF0ocHJvcHMuaXNJbkJveCl9XG51c2VTdGF0ZXtbc2VhcmNoLCBzZXRTZWFyY2hdKHByb3BzLnNlYXJjaCl9XG51c2VTdGF0ZXtbcGxhY2Vob2xkZXIsIHNldFBsYWNlaG9sZGVyXSgnXHU4QkY3XHU4RjkzXHU1MTY1XHU1MTg1XHU1QkI5Jyl9XG51c2VSZWZ7ZWRpdG9yUmVmfVxudXNlQ2FsbGJhY2t7cmVuZGVyRWxlbWVudH1cbnVzZU1lbW97ZWRpdG9yfVxudXNlQ2FsbGJhY2t7ZGVjb3JhdGV9XG51c2VFZmZlY3R7fVxudXNlRWZmZWN0e31cbnVzZUVmZmVjdHt9XG51c2VFZmZlY3R7fVxudXNlRWZmZWN0e30iKTsKCnZhciB1cGRhdGVGcmFnbWVudCA9IGZ1bmN0aW9uIHVwZGF0ZUZyYWdtZW50KGZyYWdtZW50RGF0YSkgewogIGlmICghZnJhZ21lbnREYXRhLmNoaWxkcmVuKSB7CiAgICByZXR1cm4gZnJhZ21lbnREYXRhOwogIH0KCiAgZnJhZ21lbnREYXRhLmNoaWxkcmVuID0gZnJhZ21lbnREYXRhLmNoaWxkcmVuLm1hcChmdW5jdGlvbiAoY2hpbGQpIHsKICAgIGlmIChjaGlsZC5jaGlsZHJlbiAmJiBjaGlsZC5tZWRpYVR5cGUgIT09ICdGT1JNVUxBJyAmJiBjaGlsZC5tZWRpYVR5cGUgIT09ICdJTUFHRScpIHsKICAgICAgdmFyIF91cGRhdGVGcmFnbWVudCA9IHVwZGF0ZUZyYWdtZW50KGNoaWxkKSwKICAgICAgICAgIGNoaWxkcmVuID0gX3VwZGF0ZUZyYWdtZW50LmNoaWxkcmVuOwoKICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgY2hpbGQpLCB7fSwgewogICAgICAgIGNoaWxkcmVuOiBjaGlsZHJlbgogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIGNoaWxkLnRhZyA9IFN0cmluZyhNYXRoLnJhbmRvbSgpKS5yZXBsYWNlKCdcLicsICcnKTsKICAgICAgcmV0dXJuIGNoaWxkOwogICAgfQogIH0pOwogIHJldHVybiBmcmFnbWVudERhdGE7Cn07Cgp2YXIgd2l0aE1lbnRpb25zID0gZnVuY3Rpb24gd2l0aE1lbnRpb25zKGVkaXRvciwgcHJvcHMpIHsKICB2YXIgaW5zZXJ0RGF0YSA9IGVkaXRvci5pbnNlcnREYXRhOwogIHZhciBpc0lubGluZSA9IGVkaXRvci5pc0lubGluZSwKICAgICAgaXNWb2lkID0gZWRpdG9yLmlzVm9pZDsKCiAgZWRpdG9yLnVuZG8gPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgZSA9IGVkaXRvcjsKICAgIHZhciBoaXN0b3J5ID0gZS5oaXN0b3J5OwogICAgdmFyIHVuZG9zID0gaGlzdG9yeS51bmRvczsKCiAgICBpZiAodW5kb3MubGVuZ3RoID4gMCkgewogICAgICB2YXIgYmF0Y2ggPSB1bmRvc1t1bmRvcy5sZW5ndGggLSAxXTsKICAgICAgSGlzdG9yeUVkaXRvci53aXRob3V0U2F2aW5nKGUsIGZ1bmN0aW9uICgpIHsKICAgICAgICBFZGl0b3Iud2l0aG91dE5vcm1hbGl6aW5nKGUsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciBpbnZlcnNlT3BzID0gQXJyYXkuZnJvbShiYXRjaC5tYXAoT3BlcmF0aW9uLmludmVyc2UpLnJldmVyc2UoKSk7CgogICAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBfaW52ZXJzZU9wcyA9IGludmVyc2VPcHM7IF9pIDwgX2ludmVyc2VPcHMubGVuZ3RoOyBfaSsrKSB7CiAgICAgICAgICAgIHZhciBvcCA9IF9pbnZlcnNlT3BzW19pXTsKCiAgICAgICAgICAgIC8vIElmIHRoZSBmaW5hbCBvcGVyYXRpb24gaXMgZGVzZWxlY3RpbmcgdGhlIGVkaXRvciwgc2tpcCBpdC4gVGhpcyBpcwogICAgICAgICAgICBpZiAob3AgPT09IGludmVyc2VPcHNbaW52ZXJzZU9wcy5sZW5ndGggLSAxXSAmJiAvLyBAdHMtaWdub3JlCiAgICAgICAgICAgIG9wLnR5cGUgPT09ICdzZXRfc2VsZWN0aW9uJyAmJiAoIC8vIEB0cy1pZ25vcmUKICAgICAgICAgICAgb3AubmV3UHJvcGVydGllcyA9PSBudWxsIHx8IG9wLnByb3BlcnRpZXMgPT0gbnVsbCkpIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBpZiAoIC8vIEB0cy1pZ25vcmUKICAgICAgICAgICAgICBvcC50eXBlID09PSAnc2V0X3NlbGVjdGlvbicgJiYgKG9wLm5ld1Byb3BlcnRpZXMgPT0gbnVsbCB8fCBvcC5wcm9wZXJ0aWVzID09IG51bGwpKSB7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGUuYXBwbHkob3ApOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgICBoaXN0b3J5LnJlZG9zLnB1c2goYmF0Y2gpOwogICAgICBoaXN0b3J5LnVuZG9zLnBvcCgpOwogICAgfQogIH07CgogIGVkaXRvci5pc0lubGluZSA9IGZ1bmN0aW9uIChlbGVtZW50KSB7CiAgICByZXR1cm4gZWxlbWVudC50eXBlID09PSAnbWVudGlvbicgPyB0cnVlIDogaXNJbmxpbmUoZWxlbWVudCk7CiAgfTsKCiAgZWRpdG9yLmlzVm9pZCA9IGZ1bmN0aW9uIChlbGVtZW50KSB7CiAgICByZXR1cm4gZWxlbWVudC50eXBlID09PSAnbWVudGlvbicgPyB0cnVlIDogaXNWb2lkKGVsZW1lbnQpOwogIH07CgogIGVkaXRvci5pbnNlcnREYXRhID0gZnVuY3Rpb24gKGRhdGEpIHsKICAgIHZhciBodG1sID0gZGF0YS5nZXREYXRhKCd0ZXh0L2h0bWwnKTsKICAgIHZhciBibG9iID0gZGF0YS5pdGVtc1swXSAmJiBkYXRhLml0ZW1zWzBdLmdldEFzRmlsZSgpOwogICAgdmFyIHNsYXRlRnJhZ21lbnQgPSBkYXRhLmdldERhdGEoJ2FwcGxpY2F0aW9uL3gtc2xhdGUtZnJhZ21lbnQnKTsKICAgIHZhciB0ZXh0RGF0YSA9IGRhdGEuZ2V0RGF0YSgndGV4dC9wbGFpbicpOwogICAgdmFyIHBhcnNlZCA9IG5ldyBET01QYXJzZXIoKS5wYXJzZUZyb21TdHJpbmcoaHRtbCwgJ3RleHQvaHRtbCcpOwogICAgdmFyIHNjcmlwdHMgPSBwYXJzZWQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3NjcmlwdCcpOwoKICAgIGlmIChzY3JpcHRzLmxlbmd0aCkgewogICAgICB2YXIgZnJhZ21lbnREYXRhID0gSlNPTi5wYXJzZShkZWNvZGVVUklDb21wb25lbnQod2luZG93LmF0b2Ioc2xhdGVGcmFnbWVudCkpKTsKICAgICAgdmFyIGlzTGlzdCA9IGZyYWdtZW50RGF0YS5maWx0ZXIoZnVuY3Rpb24gKGZyYWdtZW50KSB7CiAgICAgICAgcmV0dXJuIGZyYWdtZW50Lk51bWJlcmVkTGlzdDsKICAgICAgfSk7CiAgICAgIGZyYWdtZW50RGF0YSA9IGZyYWdtZW50RGF0YS5tYXAoZnVuY3Rpb24gKGZyYWdtZW50KSB7CiAgICAgICAgcmV0dXJuIHVwZGF0ZUZyYWdtZW50KGZyYWdtZW50KTsKICAgICAgfSk7CgogICAgICBpZiAocHJvcHMuaXNvcHRpb24pIHsKICAgICAgICB2YXIgbmV3RnJhZ21lbnREYXRhID0gW107CgogICAgICAgIF8ubWFwKGZyYWdtZW50RGF0YSwgZnVuY3Rpb24gKGVsKSB7CiAgICAgICAgICBpZiAoZWwuTnVtYmVyZWRMaXN0KSB7CiAgICAgICAgICAgIF8ubWFwKGVsLmNoaWxkcmVuLCBmdW5jdGlvbiAoZWwpIHsKICAgICAgICAgICAgICBpZiAobmV3RnJhZ21lbnREYXRhLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgbmV3RnJhZ21lbnREYXRhID0gXy5jbG9uZURlZXAoW2VsXSk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG5ld0ZyYWdtZW50RGF0YVswXS5jaGlsZHJlbiA9IG5ld0ZyYWdtZW50RGF0YVswXS5jaGlsZHJlbi5jb25jYXQoZWwuY2hpbGRyZW4pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAobmV3RnJhZ21lbnREYXRhLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgIG5ld0ZyYWdtZW50RGF0YSA9IF8uY2xvbmVEZWVwKFtlbF0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIG5ld0ZyYWdtZW50RGF0YVswXS5jaGlsZHJlbiA9IG5ld0ZyYWdtZW50RGF0YVswXS5jaGlsZHJlbi5jb25jYXQoZWwuY2hpbGRyZW4pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIGZyYWdtZW50RGF0YSA9IG5ld0ZyYWdtZW50RGF0YTsKICAgICAgfQoKICAgICAgaWYgKCFpc0xpc3QubGVuZ3RoKSB7CiAgICAgICAgVHJhbnNmb3Jtcy5pbnNlcnRGcmFnbWVudChlZGl0b3IsIGZyYWdtZW50RGF0YSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKGVkaXRvci5zZWxlY3Rpb24uYW5jaG9yLm9mZnNldCA9PT0gMCAmJiBlZGl0b3Iuc2VsZWN0aW9uLmFuY2hvci5wYXRoLnJlZHVjZShmdW5jdGlvbiAocmVkdWNlLCBwYXRoKSB7CiAgICAgICAgICByZXR1cm4gcmVkdWNlICsgcGF0aDsKICAgICAgICB9LCAwKSA9PT0gMCkgewogICAgICAgICAgVHJhbnNmb3Jtcy5yZW1vdmVOb2RlcyhlZGl0b3IsIGVkaXRvci5zZWxlY3Rpb24pOwogICAgICAgIH0KCiAgICAgICAgVHJhbnNmb3Jtcy5pbnNlcnROb2RlcyhlZGl0b3IsIGZyYWdtZW50RGF0YSk7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoYmxvYikgewogICAgICAvKiBlc2xpbnQtZGlzYWJsZSAqLwogICAgICB2YXIgYSA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7CiAgICAgICAgbmV3IFVwbG9hZEZpbGUoewogICAgICAgICAgYmxvYjogYmxvYiwKICAgICAgICAgIGNhbGxCYWNrOiBmdW5jdGlvbiBjYWxsQmFjayhlKSB7CiAgICAgICAgICAgIHJlc29sdmUoZSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgIC8vIOaPkuWFpeWbvueJh+WGheWuuQogICAgICAgIFRyYW5zZm9ybXMuaW5zZXJ0Tm9kZXMoZWRpdG9yLCB7CiAgICAgICAgICBtZWRpYVR5cGU6ICdJTUFHRScsCiAgICAgICAgICBjaGFyYWN0ZXI6IHJlcywKICAgICAgICAgIGNoaWxkcmVuOiBbewogICAgICAgICAgICB0ZXh0OiAnJywKICAgICAgICAgICAgbWFyazogW10KICAgICAgICAgIH1dLAogICAgICAgICAgdHlwZTogJ21lbnRpb24nCiAgICAgICAgfSk7CiAgICAgICAgdmFyIHBhdGggPSBlZGl0b3Iuc2VsZWN0aW9uLmFuY2hvci5wYXRoOwogICAgICAgIHZhciBuZXdQYXRoID0gW107CiAgICAgICAgdmFyIG5ld1Bvc2l0aW9uZyA9IFtdOyAvLyDkv67mlLnogZrnhKbnmoTlnZDmoIcKCiAgICAgICAgaWYgKHBhdGgubGVuZ3RoID09PSA0KSB7CiAgICAgICAgICBuZXdQYXRoID0gW3BhdGhbMF0sIHBhdGhbMV0sIHBhdGhbMl0gKyAxXTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbmV3UGF0aCA9IFtwYXRoWzBdLCBwYXRoWzFdICsgMV07CiAgICAgICAgfSAvLyDlr7nlt6bovrnov5vooYzotYvlgLwKCgogICAgICAgIG5ld1Bvc2l0aW9uZyA9IHsKICAgICAgICAgIGFuY2hvcjogewogICAgICAgICAgICBvZmZzZXQ6IDAsCiAgICAgICAgICAgIHBhdGg6IG5ld1BhdGgKICAgICAgICAgIH0sCiAgICAgICAgICBmb2N1czogewogICAgICAgICAgICBvZmZzZXQ6IDAsCiAgICAgICAgICAgIHBhdGg6IG5ld1BhdGgKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIFRyYW5zZm9ybXMuc2V0U2VsZWN0aW9uKGVkaXRvciwgbmV3UG9zaXRpb25nKTsKICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICB2YXIgZnJvbUN1dCA9IGZhbHNlOwoKICAgICAgdHJ5IHsKICAgICAgICAvLyDlpITnkIZKU09O6ZSZ6K+vCiAgICAgICAgZnJvbUN1dCA9IEpTT04ucGFyc2UodGV4dERhdGEpLmZyb21DdXQ7CiAgICAgIH0gY2F0Y2ggKGUpIHt9CgogICAgICBpZiAoc2xhdGVGcmFnbWVudCB8fCBmcm9tQ3V0KSB7CiAgICAgICAgdmFyIF9mcmFnbWVudERhdGEgPSBmcm9tQ3V0ID8gSlNPTi5wYXJzZSh0ZXh0RGF0YSkuZnJhZ21lbnQgOiBKU09OLnBhcnNlKGRlY29kZVVSSUNvbXBvbmVudCh3aW5kb3cuYXRvYihzbGF0ZUZyYWdtZW50KSkpOwoKICAgICAgICBpZiAocHJvcHMuaXNvcHRpb24pIHsKICAgICAgICAgIHZhciBfbmV3RnJhZ21lbnREYXRhID0gW107CgogICAgICAgICAgXy5tYXAoX2ZyYWdtZW50RGF0YSwgZnVuY3Rpb24gKGVsKSB7CiAgICAgICAgICAgIGlmIChlbC5OdW1iZXJlZExpc3QpIHsKICAgICAgICAgICAgICBfLm1hcChlbC5jaGlsZHJlbiwgZnVuY3Rpb24gKGVsKSB7CiAgICAgICAgICAgICAgICBpZiAoX25ld0ZyYWdtZW50RGF0YS5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgICAgX25ld0ZyYWdtZW50RGF0YSA9IF8uY2xvbmVEZWVwKFtlbF0pOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgX25ld0ZyYWdtZW50RGF0YVswXS5jaGlsZHJlbiA9IF9uZXdGcmFnbWVudERhdGFbMF0uY2hpbGRyZW4uY29uY2F0KGVsLmNoaWxkcmVuKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBpZiAoX25ld0ZyYWdtZW50RGF0YS5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgIF9uZXdGcmFnbWVudERhdGEgPSBfLmNsb25lRGVlcChbZWxdKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgX25ld0ZyYWdtZW50RGF0YVswXS5jaGlsZHJlbiA9IF9uZXdGcmFnbWVudERhdGFbMF0uY2hpbGRyZW4uY29uY2F0KGVsLmNoaWxkcmVuKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwoKICAgICAgICAgIFRyYW5zZm9ybXMuaW5zZXJ0RnJhZ21lbnQoZWRpdG9yLCBfbmV3RnJhZ21lbnREYXRhKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmFyIGlzTnVtYmVyZWRMaXN0ID0gX2ZyYWdtZW50RGF0YS5maWx0ZXIoZnVuY3Rpb24gKGZyYWdtZW50KSB7CiAgICAgICAgICAgIHJldHVybiBmcmFnbWVudC5OdW1iZXJlZExpc3Q7CiAgICAgICAgICB9KS5sZW5ndGg7CgogICAgICAgICAgaWYgKGlzTnVtYmVyZWRMaXN0IHx8IGZyb21DdXQpIHsKICAgICAgICAgICAgaWYgKGVkaXRvci5zZWxlY3Rpb24uYW5jaG9yLm9mZnNldCA9PT0gMCAmJiBlZGl0b3Iuc2VsZWN0aW9uLmFuY2hvci5wYXRoLnJlZHVjZShmdW5jdGlvbiAocmVkdWNlLCBwYXRoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHJlZHVjZSArIHBhdGg7CiAgICAgICAgICAgIH0sIDApID09PSAwKSB7CiAgICAgICAgICAgICAgVHJhbnNmb3Jtcy5yZW1vdmVOb2RlcyhlZGl0b3IsIGVkaXRvci5zZWxlY3Rpb24pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBUcmFuc2Zvcm1zLmluc2VydE5vZGVzKGVkaXRvciwgX2ZyYWdtZW50RGF0YSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpbnNlcnREYXRhKGRhdGEpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBpbnNlcnREYXRhKGRhdGEpOwogICAgICB9CiAgICB9CiAgfTsKCiAgcmV0dXJuIGVkaXRvcjsKfTsKCnZhciBfZGVmYXVsdCA9IFJpY2hUZXh0OwpleHBvcnQgZGVmYXVsdCBfZGVmYXVsdDsKCmlmICh0eXBlb2YgUmljaFRleHQgIT09ICd1bmRlZmluZWQnICYmIFJpY2hUZXh0ICYmIFJpY2hUZXh0ID09PSBPYmplY3QoUmljaFRleHQpICYmIE9iamVjdC5pc0V4dGVuc2libGUoUmljaFRleHQpKSB7CiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFJpY2hUZXh0LCAnX19maWxlbWV0YScsIHsKICAgIGVudW1lcmFibGU6IHRydWUsCiAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICB2YWx1ZTogewogICAgICBuYW1lOiAiUmljaFRleHQiLAogICAgICBmaWxlbmFtZTogInNyY1xcUXVlc3Rpb25FZGl0b3JcXGVkaXRvclxccmljaHRleHQudHN4IgogICAgfQogIH0pOwp9Cgo7CgooZnVuY3Rpb24gKCkgewogIHZhciByZWFjdEhvdExvYWRlciA9IHR5cGVvZiByZWFjdEhvdExvYWRlckdsb2JhbCAhPT0gJ3VuZGVmaW5lZCcgPyByZWFjdEhvdExvYWRlckdsb2JhbC5kZWZhdWx0IDogdW5kZWZpbmVkOwoKICBpZiAoIXJlYWN0SG90TG9hZGVyKSB7CiAgICByZXR1cm47CiAgfQoKICByZWFjdEhvdExvYWRlci5yZWdpc3RlcihSaWNoVGV4dCwgIlJpY2hUZXh0IiwgIkY6XFxzbGF0ZVxcZWFzdGVkdUNvbXBvZW50c1xcc3JjXFxRdWVzdGlvbkVkaXRvclxcZWRpdG9yXFxyaWNodGV4dC50c3giKTsKICByZWFjdEhvdExvYWRlci5yZWdpc3Rlcih1cGRhdGVGcmFnbWVudCwgInVwZGF0ZUZyYWdtZW50IiwgIkY6XFxzbGF0ZVxcZWFzdGVkdUNvbXBvZW50c1xcc3JjXFxRdWVzdGlvbkVkaXRvclxcZWRpdG9yXFxyaWNodGV4dC50c3giKTsKICByZWFjdEhvdExvYWRlci5yZWdpc3Rlcih3aXRoTWVudGlvbnMsICJ3aXRoTWVudGlvbnMiLCAiRjpcXHNsYXRlXFxlYXN0ZWR1Q29tcG9lbnRzXFxzcmNcXFF1ZXN0aW9uRWRpdG9yXFxlZGl0b3JcXHJpY2h0ZXh0LnRzeCIpOwogIHJlYWN0SG90TG9hZGVyLnJlZ2lzdGVyKF9kZWZhdWx0LCAiZGVmYXVsdCIsICJGOlxcc2xhdGVcXGVhc3RlZHVDb21wb2VudHNcXHNyY1xcUXVlc3Rpb25FZGl0b3JcXGVkaXRvclxccmljaHRleHQudHN4Iik7Cn0pKCk7Cgo7CgooZnVuY3Rpb24gKCkgewogIHZhciBsZWF2ZU1vZHVsZSA9IHR5cGVvZiByZWFjdEhvdExvYWRlckdsb2JhbCAhPT0gJ3VuZGVmaW5lZCcgPyByZWFjdEhvdExvYWRlckdsb2JhbC5sZWF2ZU1vZHVsZSA6IHVuZGVmaW5lZDsKICBsZWF2ZU1vZHVsZSAmJiBsZWF2ZU1vZHVsZShtb2R1bGUpOwp9KSgpOw=="},{"version":3,"sources":["F:/slate/easteduCompoents/src/QuestionEditor/editor/richtext.tsx"],"names":["React","useCallback","useMemo","useState","useEffect","useRef","isHotkey","Editable","withReact","Slate","Text","Element","Leaf","MarkIcon","MarkSubscript","MarkVertAlign","MarkTextIndent","MarkWordSpace","Symbol","MarkInsertFormula","MarkAlignment","UnorderedSorting","OrderSorting","MarkColor","MarkFont","MarkFormulaEditor","bold","centerAlignment","disorder","Italic","leftAlignment","order","point","rightAlignment","strikeout","subscript","superscript","textIndent","underline","wordspace","lineSpace","TextIndentList","LineSpaceList","ListWordSpace","fontSizeList","fontList","fontObj","fontSizeObj","showMathJax","Editor","Operation","Transforms","Node","createEditor","Path","withHistory","HistoryEditor","Toolbar","FormulaEditor","_","Tips","UploadFile","RichText","props","value","setValue","isFocuse","setIsFocuse","isSelection","setIsSelection","formula","setFormula","selection","setSelection","modalPosition","setModalPosition","modalPositionInsertFormula","setModalPositionInsertFormula","isInBox","setIsInBox","search","setSearch","placeholder","setPlaceholder","editorRef","renderElement","renderLeaf","editor","withMentions","decorate","node","path","newRanges","len","length","isText","text","forEach","item","index","texts","markLen","replaceStr","j","el","replace","RegExp","parts","split","offset","part","i","push","anchor","focus","highlight","sort","pre","next","d","compare","finalRanges","reduce","acc","item1","JSON","parse","stringify","addDblEvent","e","navigator","onLine","getMathML","target","className","indexOf","open","message","type","getAttribute","parentNode","setTimeout","current","addEventListener","cleanup","removeEventListener","isFilled","isSelections","updateFormula","tag","children","_path","splice","key","insertNodes","mediaType","character","String","Math","random","mark","at","newSelection","child","element","isAdd","styles","NumberedList","ListItem","cloneDeep","changeValue","console","log","isFistRich","color","changeColor","sortFormat","setFormat","isCloseMedoal","positionInsertFormula","setVisible","postion","minHeight","isOption","autoFocus","error","visible","deleteFragment","event","keyCode","isoption","preventDefault","b","parent","deleteBackward","unit","a","get","unwrapNodes","match","n","setNodes","removeNodes","selectionFragment","fragment","hasFormula","filter","cloneActiveElement","fromCut","copyText","document","getElementById","innerHTML","readOnly","select","setSelectionRange","execCommand","updateFragment","fragmentData","map","insertData","isInline","isVoid","undo","history","undos","batch","withoutSaving","withoutNormalizing","inverseOps","Array","from","inverse","reverse","op","newProperties","properties","apply","redos","pop","data","html","getData","blob","items","getAsFile","slateFragment","textData","parsed","DOMParser","parseFromString","scripts","getElementsByTagName","decodeURIComponent","window","atob","isList","newFragmentData","concat","insertFragment","Promise","resolve","callBack","then","res","newPath","newPositiong","isNumberedList"],"mappings":"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","sourcesContent":["// @ts-ignore\r\nimport React, {useCallback, useMemo, useState, useEffect, useRef} from 'react';\r\nimport isHotkey, {isKeyHotkey, toKeyName, toKeyCode} from 'is-hotkey';\r\nimport {\r\n  Editable,\r\n  withReact,\r\n  useSlate,\r\n  Slate,\r\n  useSelected,\r\n  useFocused,\r\n} from 'slate-react';\r\nimport {Text} from 'slate'\r\n\r\nimport {\r\n  Element,\r\n  MentionElement,\r\n  Leaf,\r\n  MarkIcon,\r\n  MarkSubscript,\r\n  MarkVertAlign,\r\n  MarkNode,\r\n  MarkTextIndent,\r\n  MarkWordSpacing,\r\n  MarkWordSpace,\r\n  Symbol,\r\n  MarkInsertFormula,\r\n  MarkAlignment,\r\n  UnorderedSorting,\r\n  OrderSorting,\r\n  MarkColor,\r\n  MarkFont,\r\n  MarkFormulaEditor\r\n} from './richtextDetail';\r\n\r\nimport {\r\n  bold,\r\n  centerAlignment,\r\n  cleanUp,\r\n  disorder,\r\n  formatMatch,\r\n  Italic,\r\n  leftAlignment,\r\n  order,\r\n  picture,\r\n  pinyin,\r\n  point,\r\n  rightAlignment,\r\n  strikeout,\r\n  subscript,\r\n  superscript,\r\n  symbol,\r\n  textIndent,\r\n  triangle,\r\n  underline,\r\n  video,\r\n  wordspace,\r\n  lineSpace,\r\n  lowerTriangle,\r\n  insertFormula\r\n} from './toolbarIcon';\r\n\r\nimport {\r\n  TextIndentList,\r\n  LineSpaceList,\r\n  ListWordSpace,\r\n  fontSizeList,\r\n  fontList,\r\n  fontObj,\r\n  fontSizeObj,\r\n  showMathJax\r\n} from './client';\r\n\r\nimport {Editor, Operation, Transforms, Node, createEditor, Path} from 'slate';\r\nimport {withHistory, HistoryEditor} from 'slate-history';\r\n\r\nimport {Toolbar} from './components';\r\nimport FormulaEditor from './components/FormulaEditor';\r\nimport './richtext.less';\r\nimport _ from 'lodash';\r\n// import { Tips } from '../../components/index';\r\nimport {Tips} from '../../MessageTips/index';\r\n\r\nimport UploadFile from './components/UploadFile';\r\n\r\n\r\nconst RichText = (props: any) => {\r\n\r\n  const [value, setValue] = useState(props.value);\r\n\r\n  const [isFocuse, setIsFocuse] = useState(false);\r\n  const [isSelection, setIsSelection] = useState(false);\r\n  const [formula, setFormula] = useState(null);\r\n  const [selection, setSelection] = useState(null);\r\n  const [modalPosition, setModalPosition] = useState(props.modalPosition);\r\n  const [modalPositionInsertFormula, setModalPositionInsertFormula] = useState(props.modalPositionInsertFormula);\r\n  const [isInBox, setIsInBox] = useState(props.isInBox);\r\n  const [search, setSearch] = useState(props.search);\r\n  const [placeholder, setPlaceholder] = useState('请输入内容');\r\n\r\n\r\n  // const [insertCompositionText, setInsertCompositionText] = useState(false);\r\n  const editorRef = useRef();\r\n  const renderElement = useCallback(props => <Element {...props} />, []);\r\n  const renderLeaf = (props: any) => <Leaf {...props} />;\r\n  const editor = useMemo(() => withMentions(withHistory(withReact(createEditor())), props), []);\r\n\r\n  // 对常见错误的字段进行检查\r\n  const decorate = useCallback(([node, path]) => {\r\n    const newRanges: any = []\r\n    const len = search.length !== 0;\r\n    if (len && Text.isText(node)) {\r\n      const {text} = node;\r\n\r\n      search.forEach((item: any, index: number) => {\r\n        let texts = text;\r\n        const markLen = index + 1;\r\n        let replaceStr = '**';\r\n        for (let j = 0; j < markLen; j++) {\r\n          replaceStr += '>';\r\n        }\r\n        ;\r\n        replaceStr += '**';\r\n\r\n        item.forEach((el: string) => {\r\n          if (el !== '+' &&\r\n            el !== '[' &&\r\n            el !== '(' &&\r\n            el !== ')' &&\r\n            el !== ']') {\r\n            texts = texts.replace(new RegExp(`${el}`, 'g'), replaceStr);\r\n          } else {\r\n            texts = texts.replace(new RegExp(`\\\\${el}`, 'g'), replaceStr);\r\n          }\r\n        })\r\n\r\n        // 标记高亮字段\r\n        const parts = texts.split(replaceStr);\r\n        let offset = 0;\r\n        parts.forEach((part: any, i: number) => {\r\n          if (part[i] === '' && i === 0) {\r\n            newRanges.push({\r\n              anchor: {path, offset},\r\n              focus: {path, offset: offset + markLen},\r\n              highlight: true,\r\n            });\r\n            offset = offset + markLen;\r\n            return true;\r\n          }\r\n\r\n          if (i !== 0) {\r\n            newRanges.push({\r\n              anchor: {path, offset},\r\n              focus: {path, offset: offset + markLen},\r\n              highlight: true,\r\n            });\r\n            offset = offset + part.length + markLen;\r\n            return true;\r\n          } else {\r\n            offset = offset + part.length;\r\n          }\r\n        })\r\n      });\r\n    }\r\n    ;\r\n\r\n    // 排序\r\n    newRanges.sort((pre: any, next: any) => {\r\n      if (pre.anchor && next.anchor) {\r\n        const d = Path.compare(pre.anchor.path, next.anchor.path);\r\n        if (d === 0) {\r\n          return pre.anchor.offset - next.anchor.offset;\r\n        } else {\r\n          return d;\r\n        }\r\n      }\r\n      return false;\r\n    })\r\n\r\n    // 归并\r\n    const finalRanges = newRanges.reduce((acc: any, item1: any) => {\r\n      const len = acc.length;\r\n      const item = JSON.parse(JSON.stringify(item1));\r\n      if (len) {\r\n        if (Path.compare(acc[len - 1].anchor.path, item.anchor.path) === 0) {\r\n          if (acc[len - 1].focus.offset === item.anchor.offset) {  // !如果是连续的range位置\r\n            acc[len - 1].focus.offset = item.focus.offset;\r\n          } else { // !非连续位置\r\n            acc.push(item);\r\n          }\r\n        } else { // 跨元素\r\n          acc.push(item);\r\n        }\r\n      } else { // 第一次进入\r\n        acc.push(item);\r\n      }\r\n      return acc;\r\n    }, []);\r\n\r\n    return finalRanges;\r\n\r\n  }, [search]);\r\n\r\n\r\n  useEffect(() => {\r\n\r\n    setSearch(props.search);\r\n\r\n  }, [props.search])\r\n\r\n\r\n  const addDblEvent = (e: any) => {\r\n\r\n    if (navigator.onLine) {\r\n      setSelection(editor.selection);\r\n      setFormula(getMathML(e.target));\r\n    } else if (e.target.className && e.target.className.indexOf('buttonTitle') === -1) {\r\n      Tips.open({\r\n        message: '网络错误，请稍后重试',\r\n        type: 'fail'\r\n      });\r\n    }\r\n  };\r\n\r\n  const getMathML: any = function (el: any) {\r\n    if (el.getAttribute && (!el.getAttribute('class') || el.getAttribute('class').indexOf('richBox') < 0)) {\r\n      if (el.getAttribute('class') && el.getAttribute('class').indexOf('MathJax') !== -1) {\r\n        return el.getAttribute('data-mathml');\r\n      } else {\r\n        return getMathML(el.parentNode);\r\n      }\r\n    } else {\r\n      return null;\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n\r\n    setIsInBox(props.isInBox);\r\n\r\n  }, [props.isInBox]);\r\n\r\n  useEffect(() => {\r\n    setValue(props.value);\r\n    setTimeout(() => {\r\n      let {current}: any = editorRef;\r\n      current && current.addEventListener('dblclick', addDblEvent);\r\n      return function cleanup() {\r\n        current.removeEventListener('dblclick', addDblEvent);\r\n      };\r\n    }, 0);\r\n\r\n  }, [props.isFilled]);\r\n\r\n  useEffect(() => {\r\n\r\n    setModalPosition(props.modalPosition);\r\n\r\n  }, [JSON.stringify(props.modalPosition)]);\r\n\r\n  useEffect(() => {\r\n\r\n    setModalPositionInsertFormula(props.modalPositionInsertFormula);\r\n\r\n  }, [JSON.stringify(props.modalPositionInsertFormula)]);\r\n\r\n\r\n  function isSelections() {\r\n    let selection = editor.selection;\r\n    if (selection &&\r\n      selection.anchor &&\r\n      selection.focus &&\r\n      JSON.stringify(selection.anchor.path) !== JSON.stringify(selection.focus.path)) {\r\n      return true;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  function updateFormula(formula: any) {\r\n\r\n    // TODO: 插入公式可能存在问题需要后续优化\r\n\r\n    if (formula) {\r\n      // @ts-ignore\r\n      Transforms.setSelection(editor, selection);\r\n\r\n      let tag: any;\r\n      (function () {\r\n        let children = editor;\r\n        // @ts-ignore\r\n        let _path = JSON.parse(JSON.stringify(selection.anchor.path));\r\n        _path.splice(-2);\r\n        _path.forEach((key: any) => {\r\n          children = children.children[key];\r\n        });\r\n        // @ts-ignore\r\n        tag = children.children[selection.anchor.path[selection.anchor.path.length - 2]].tag;\r\n      })();\r\n      // @ts-ignore\r\n      Transforms.insertNodes(editor, {\r\n        type: 'mention',\r\n        mediaType: 'FORMULA',\r\n        character: formula,\r\n        tag: String(Math.random()).replace('\\.', ''),\r\n        children: [{text: ' ', mark: []}],\r\n      }, {\r\n        // @ts-ignore\r\n        at: selection\r\n      });\r\n\r\n      let newSelection = JSON.parse(JSON.stringify(selection));\r\n\r\n      (function () {\r\n        let children = editor;\r\n        // @ts-ignore\r\n        let _path = JSON.parse(JSON.stringify(selection.anchor.path));\r\n        _path.splice(-2);\r\n        _path.forEach((key: any) => {\r\n          children = children.children[key];\r\n        });\r\n\r\n        children.children.forEach((child: any, index: number) => {\r\n          if (child.tag === tag) {\r\n            newSelection.anchor.path[newSelection.anchor.path.length - 2] = index;\r\n            newSelection.focus.path[newSelection.focus.path.length - 2] = index;\r\n          }\r\n        });\r\n\r\n      })();\r\n\r\n      Transforms.delete(editor, {\r\n        at: newSelection\r\n      });\r\n    }\r\n    setSelection(null);\r\n    setFormula(null);\r\n    setTimeout(() => {\r\n      showMathJax(true);\r\n    }, 0);\r\n  }\r\n  // @ts-ignore\r\n  return (\r\n    <div\r\n      // @ts-ignore\r\n      ref={editorRef}\r\n      className={`${'richBox'} ${isFocuse ? 'isChoose' : ''}`}\r\n    >\r\n      <Slate\r\n        editor={editor}\r\n        value={value}\r\n        onChange={(e: any) => {\r\n          // const { selection } = editor;\r\n          // setValue(e);\r\n          let element = [];\r\n\r\n          if (\r\n            e.length === 1 &&\r\n            e[0].children.length === 1 &&\r\n            e[0].children[0].text === '' &&\r\n            (!e[0].children[0].isAdd)\r\n          ) {\r\n            element = [\r\n              {\r\n                children: [\r\n                  {text: ''}\r\n                ],\r\n                styles: [],\r\n                type: 'Left'\r\n              }];\r\n          } else if (e.length && e[0].NumberedList) {\r\n\r\n            if (e.length === 1 &&\r\n              e[0].children.length === 1 &&\r\n              e[0].children[0].children.length === 1 &&\r\n              e[0].children[0].children[0].text === '') {\r\n              element = [\r\n                {\r\n                  NumberedList: e[0].NumberedList,\r\n                  children: [{\r\n                    children: [\r\n                      {text: ''}\r\n                    ],\r\n                    styles: [],\r\n                    type: 'Left',\r\n                    ListItem: true\r\n                  }]\r\n                }\r\n              ];\r\n            } else if (e[0].children[0].children[0].text === '') {\r\n              element = _.cloneDeep(e);\r\n              element[0].children[0].ListItem = true;\r\n            } else {\r\n              element = e;\r\n            }\r\n          } else {\r\n            element = e;\r\n          }\r\n\r\n          if (!e.length) {\r\n            element = [\r\n              {\r\n                children: [\r\n                  {text: ''}\r\n                ],\r\n                styles: [],\r\n                type: 'Left'\r\n              }];\r\n          }\r\n\r\n          if (JSON.stringify(element) !== JSON.stringify(value)) {\r\n            props.changeValue(element);\r\n            setSearch([]);\r\n          }\r\n\r\n          setValue(element);\r\n          console.log(\"RichText -> element\", element)\r\n        }}\r\n      >\r\n        {\r\n          isFocuse || props.isFistRich ? <div\r\n            className={'Toolbar'}\r\n          >\r\n            {\r\n              // @ts-ignore\r\n              <Toolbar>\r\n              <MarkFont\r\n                format={'Font'}\r\n                fontList={fontList}\r\n                fontObj={fontObj}\r\n                width={98}\r\n                title=\"字体\"\r\n              />\r\n              <MarkFont\r\n                format={'FontSize'}\r\n                fontList={fontSizeList}\r\n                fontObj={fontSizeObj}\r\n                width={54}\r\n                title=\"字号\"\r\n              />\r\n              <MarkIcon format={'Bold'} icon={bold} title=\"加粗\"/>\r\n              <MarkIcon format={'Italic'} icon={Italic} title=\"倾斜\"/>\r\n              <MarkSubscript format={'UnderlineSingle'} icon={underline} title=\"下划线\"/>\r\n              <MarkIcon format={'Strike'} icon={strikeout} title=\"删除线\"/>\r\n              <MarkVertAlign format={'VertAlignSubscript'} icon={subscript} title=\"下标\"></MarkVertAlign>\r\n              <MarkVertAlign format={'VertAlignSuperscript'} icon={superscript} title=\"上标\"></MarkVertAlign>\r\n              <MarkIcon format={'EmphasisDot'} icon={point} title=\"着重字\"/>\r\n              <MarkColor\r\n                format={'color'}\r\n                icon={order}\r\n                title=\"字体颜色\"\r\n                color={props.color}\r\n                changeColor={(e: any) => props.changeColor(e)}\r\n              />\r\n              <span className=\"Separate\"></span>\r\n              <MarkAlignment format={'Left'} icon={leftAlignment} title=\"左对齐\"/>\r\n              <MarkAlignment format={'Center'} icon={centerAlignment} title=\"居中对齐\"/>\r\n              <MarkAlignment format={'Right'} icon={rightAlignment} title=\"右对齐\"/>\r\n              <MarkWordSpace\r\n                format={'Wordspace'}\r\n                icon={wordspace}\r\n                itemList={ListWordSpace}\r\n                unit=\"字符\"\r\n                title=\"字间距\"\r\n              >\r\n              </MarkWordSpace>\r\n              <MarkTextIndent\r\n                format={'LineSpace'}\r\n                icon={lineSpace}\r\n                itemList={LineSpaceList}\r\n                unit=\"倍\"\r\n                title=\"行和段落间距\"\r\n              >\r\n              </MarkTextIndent>\r\n              <MarkTextIndent\r\n                format={'TextIndent'}\r\n                icon={textIndent}\r\n                itemList={TextIndentList}\r\n                unit=\"字符\"\r\n                title=\"首行缩进\"\r\n              ></MarkTextIndent>\r\n\r\n              <UnorderedSorting format={'NumberedList'} icon={disorder} title=\"无序列表\"/>\r\n              <OrderSorting\r\n                format={'NumberedList'}\r\n                icon={order}\r\n                title=\"有序列表\"\r\n                sortFormat={props.sortFormat}\r\n                setFormat={props.setFormat}\r\n              />\r\n              <span className=\"Separate\"></span>\r\n              <MarkInsertFormula\r\n                title=\"从图片插入公式\"\r\n                isFocuse={isFocuse}\r\n                // setVisible={props.setVisible && props.setVisible}\r\n                modalPosition={modalPositionInsertFormula}\r\n                postion={(e: any) => {\r\n                  if (e && e.isCloseMedoal) {\r\n                    setIsFocuse(false);\r\n                    delete e.isCloseMedoal;\r\n                  }\r\n                  props.positionInsertFormula && props.positionInsertFormula(e);\r\n                }}\r\n                changeFocuse={(e: any) => setIsFocuse(e)}\r\n              />\r\n              <MarkFormulaEditor\r\n                title=\"插入公式\"\r\n                isFocuse={isFocuse}\r\n                // setVisible={props.setVisible && props.setVisible}\r\n                modalPosition={modalPositionInsertFormula}\r\n                postion={(e: any) => {\r\n                  \r\n                  console.log('e====>', e);\r\n                  \r\n                  if (e && e.isCloseMedoal) {\r\n                    setIsFocuse(false);\r\n                    delete e.isCloseMedoal;\r\n                  }\r\n                  props.positionInsertFormula && props.positionInsertFormula(e);\r\n                }}\r\n                changeFocuse={(e: any) => setIsFocuse(e)}\r\n              />\r\n              <span className=\"Separate\"></span>\r\n              <Symbol\r\n                title=\"符号\"\r\n                isFocuse={isFocuse}\r\n                setVisible={props.setVisible && props.setVisible}\r\n                modalPosition={modalPosition}\r\n                postion={props.postion && props.postion}\r\n              />\r\n            </Toolbar>\r\n            }\r\n          </div> : ''\r\n        }\r\n        {\r\n          formula ? <FormulaEditor formula={formula} onSubmit={(formula: any) => {\r\n            updateFormula(formula)\r\n          }}/> : ''\r\n        }\r\n\r\n        <Editable\r\n          decorate={decorate}\r\n          renderElement={renderElement}\r\n          renderLeaf={renderLeaf}\r\n          placeholder={placeholder}\r\n          style={{minHeight: props.isOption ? '14px' : '63px'}}\r\n          autoFocus={props.autoFocus ? props.autoFocus : false}\r\n          onFocus={() => {\r\n            console.error(1);\r\n            setIsFocuse(true);\r\n            props.isInBox && props.isInBox(true);\r\n          }}\r\n          onBlur={() => {\r\n            console.error(2);\r\n            if (!modalPositionInsertFormula.visible || isInBox) {\r\n              setIsFocuse(false);\r\n            }\r\n          }}\r\n          onMouseMove={() => {\r\n            if (isSelections()) {\r\n              setIsSelection(true);\r\n            } else {\r\n              setIsSelection(false);\r\n            }\r\n          }}\r\n          onDOMBeforeInput={() => {\r\n\r\n          }}\r\n          onInput={() => {\r\n            if (isSelection || isSelections()) {\r\n              editor.deleteFragment();\r\n              setIsSelection(false);\r\n            }\r\n          }}\r\n          onKeyDown={(event: any) => {\r\n\r\n            if (event.keyCode === 13 && props.isoption) {\r\n              event.preventDefault();\r\n            }\r\n\r\n            const {selection} = editor;\r\n\r\n            if (selection &&\r\n              selection.anchor.offset === 0 &&\r\n              selection.focus.offset !== 0) {\r\n              setSearch('');\r\n\r\n            }\r\n\r\n            if (isHotkey('delete', event) || isHotkey('backspace', event)) {\r\n              if(!editor.selection) return false; // 2020/06/22 修改 删除会报错 editor.select === null;\r\n              let path = editor.selection && editor.selection.anchor.path;\r\n              let b = Node.parent(editor, editor.selection.anchor.path);\r\n\r\n              // Editor.removeMark(editor, 'Bold');\r\n              if (path && b && b.type === 'mention') {\r\n                event.preventDefault();\r\n                editor.deleteBackward({unit: 'character'});\r\n              }\r\n\r\n              // 处理首行是排序列表的时候，敲击回退键进行删除排序样式\r\n              if (event.keyCode === 8) {\r\n\r\n                let a = Node.get(editor, editor.selection.anchor.path);\r\n                let b = Node.parent(editor, editor.selection.anchor.path);\r\n\r\n                if (\r\n                  a.text === '' &&\r\n                  b.ListItem &&\r\n                  b.children.length === 1\r\n                  && editor.selection.anchor.path[0] === 0\r\n                  && editor.selection.anchor.path[1] === 0\r\n                ) {\r\n\r\n                  Transforms.unwrapNodes(editor, {\r\n                    // @ts-ignore\r\n                    match: n => n['NumberedList'],\r\n                    split: true,\r\n                  });\r\n                  Transforms.setNodes(editor, {\r\n                    'ListItem': false,\r\n                  });\r\n                }\r\n              }\r\n              const selection = JSON.parse(JSON.stringify(editor.selection));\r\n              const children = JSON.parse(JSON.stringify(editor.children));\r\n              if (JSON.stringify(selection.anchor) !== JSON.stringify(selection.focus) && selection.anchor.path[1] === 0 && selection.anchor.offset === 0) {\r\n                // patch: 判断是否从头选到尾\r\n                if (selection.anchor.path[0] === 0 &&\r\n                  selection.focus.path[0] === children.length - 1 &&\r\n                  selection.focus.path[1] === children[children.length - 1].children.length - 1 &&\r\n                  selection.focus.offset === children[selection.focus.path[0]].children[selection.focus.path[1]].text.length\r\n                ) {\r\n                  Transforms.removeNodes(editor);\r\n                }\r\n              }\r\n            } else if (event.keyCode === 229) {\r\n\r\n              let path = editor.selection && editor.selection.anchor.path;\r\n\r\n              if (isSelection || isSelections()) {\r\n\r\n                event.preventDefault();\r\n                editor.deleteFragment();\r\n                setIsSelection(false);\r\n\r\n              }\r\n            } else if (isHotkey('Control+X', event) || isHotkey('Command+X', event)) { // 在剪切的时候，删除图片\r\n              const selection = JSON.parse(JSON.stringify(editor.selection));\r\n              const selectionFragment = JSON.parse(JSON.stringify(Node.fragment(editor, selection)));\r\n              const children = JSON.parse(JSON.stringify(editor.children));\r\n              const hasFormula = selectionFragment.filter((fragment: any) => {\r\n                return fragment.children.filter((child: any) => {\r\n                  return child.mediaType === 'FORMULA' || child.mediaType === 'IMAGE'\r\n                }).length\r\n              });\r\n              console.log(hasFormula)\r\n              if (hasFormula.length) {\r\n                if (JSON.stringify(selection.anchor) !== JSON.stringify(selection.focus) && selection.anchor.path[1] === 0 && selection.anchor.offset === 0) {\r\n                  Transforms.removeNodes(editor, selection);\r\n                  // patch: 判断是否从头选到尾\r\n                  if (selection.anchor.path[0] === 0 &&\r\n                    selection.focus.path[0] === children.length - 1 &&\r\n                    selection.focus.path[1] === children[children.length - 1].children.length - 1 &&\r\n                    selection.focus.offset === children[selection.focus.path[0]].children[selection.focus.path[1]].text.length\r\n                  ) {\r\n                    Transforms.removeNodes(editor);\r\n                  }\r\n                } else {\r\n                  Transforms.delete(editor, {\r\n                    at: selection\r\n                  });\r\n                }\r\n                event.preventDefault();\r\n                const cloneActiveElement = JSON.stringify({\r\n                  fromCut: true,\r\n                  fragment: selectionFragment\r\n                });\r\n                const copyText: any = document.getElementById(\"copy_text\");\r\n                copyText.innerHTML = cloneActiveElement;\r\n                copyText.readOnly = false;\r\n                copyText.select();\r\n                copyText.setSelectionRange(0, copyText.value.length);\r\n                document.execCommand(\"copy\");\r\n                copyText.readOnly = true;\r\n              }\r\n            }\r\n          }}\r\n        />\r\n      </Slate>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst updateFragment = (fragmentData: any) => {\r\n  if (!fragmentData.children) {\r\n    return fragmentData;\r\n  }\r\n  fragmentData.children = fragmentData.children.map((child: any) => {\r\n    if (child.children && child.mediaType !== 'FORMULA' && child.mediaType !== 'IMAGE') {\r\n      const {children} = updateFragment(child);\r\n      return {\r\n        ...child,\r\n        children\r\n      };\r\n    } else {\r\n      child.tag = String(Math.random()).replace('\\.', '');\r\n      return child;\r\n    }\r\n  });\r\n  return fragmentData;\r\n};\r\n\r\nconst withMentions = (editor: any, props: any) => {\r\n  const {insertData} = editor;\r\n  const {isInline, isVoid} = editor;\r\n\r\n  editor.undo = function () {\r\n\r\n    let e = editor;\r\n\r\n    let history = e.history;\r\n    let undos = history.undos;\r\n\r\n    if (undos.length > 0) {\r\n      let batch = undos[undos.length - 1];\r\n      HistoryEditor.withoutSaving(e, () => {\r\n        Editor.withoutNormalizing(e, () => {\r\n          const inverseOps = Array.from(batch.map(Operation.inverse).reverse());\r\n\r\n          for (const op of inverseOps) {\r\n            // If the final operation is deselecting the editor, skip it. This is\r\n            if (\r\n              op === inverseOps[inverseOps.length - 1] &&\r\n              // @ts-ignore\r\n              op.type === 'set_selection' &&\r\n              // @ts-ignore\r\n              (op.newProperties == null || op.properties == null)\r\n            ) {\r\n              continue;\r\n            } else {\r\n              if (\r\n                // @ts-ignore\r\n                op.type === 'set_selection' && (op.newProperties == null || op.properties == null)\r\n              ) {\r\n                continue;\r\n              }\r\n              e.apply(op);\r\n            }\r\n          }\r\n        });\r\n      });\r\n      history.redos.push(batch);\r\n      history.undos.pop();\r\n    }\r\n  };\r\n\r\n  editor.isInline = (element: any) => {\r\n    return element.type === 'mention' ? true : isInline(element);\r\n  };\r\n\r\n  editor.isVoid = (element: any) => {\r\n    return element.type === 'mention' ? true : isVoid(element);\r\n  };\r\n\r\n  editor.insertData = (data: any) => {\r\n\r\n    const html = data.getData('text/html');\r\n\r\n    let blob = data.items[0] && data.items[0].getAsFile();\r\n    const slateFragment = data.getData('application/x-slate-fragment');\r\n    const textData = data.getData('text/plain');\r\n    const parsed = new DOMParser().parseFromString(html, 'text/html');\r\n    const scripts = parsed.getElementsByTagName('script');\r\n    if (scripts.length) {\r\n      let fragmentData = JSON.parse(decodeURIComponent(window.atob(slateFragment)));\r\n      const isList = fragmentData.filter((fragment: any) => {\r\n        return fragment.NumberedList\r\n      });\r\n      fragmentData = fragmentData.map((fragment: any) => {\r\n        return updateFragment(fragment);\r\n      });\r\n      if (props.isoption) {\r\n        let newFragmentData: any = [];\r\n        _.map(fragmentData, (el: any) => {\r\n          if (el.NumberedList) {\r\n\r\n            _.map(el.children, (el: any) => {\r\n              if (newFragmentData.length === 0) {\r\n                newFragmentData = _.cloneDeep([el]);\r\n              } else {\r\n                newFragmentData[0].children = newFragmentData[0].children.concat(el.children);\r\n              }\r\n\r\n            });\r\n          } else {\r\n\r\n            if (newFragmentData.length === 0) {\r\n              newFragmentData = _.cloneDeep([el]);\r\n            } else {\r\n              newFragmentData[0].children = newFragmentData[0].children.concat(el.children);\r\n            }\r\n\r\n          }\r\n        });\r\n        fragmentData = newFragmentData\r\n      }\r\n\r\n      if (!isList.length) {\r\n        Transforms.insertFragment(editor, fragmentData);\r\n      } else {\r\n        if (\r\n          editor.selection.anchor.offset === 0 &&\r\n          editor.selection.anchor.path\r\n            .reduce((reduce: number, path: any) => reduce + path, 0) === 0\r\n        ) {\r\n          Transforms.removeNodes(editor, editor.selection);\r\n        }\r\n        Transforms.insertNodes(editor, fragmentData);\r\n      }\r\n    } else if (blob) {\r\n      /* eslint-disable */\r\n      let a = new Promise((resolve) => {\r\n        new UploadFile({\r\n          blob: blob,\r\n          callBack: (e: any) => {\r\n            resolve(e);\r\n          }\r\n        });\r\n      }).then((res) => {\r\n\r\n        // 插入图片内容\r\n        Transforms.insertNodes(editor, {\r\n          mediaType: 'IMAGE',\r\n          character: res,\r\n          children: [{text: '', mark: []}],\r\n          type: 'mention'\r\n        });\r\n        let {path} = editor.selection.anchor;\r\n        let newPath = [];\r\n        let newPositiong: any = [];\r\n\r\n        // 修改聚焦的坐标\r\n        if (path.length === 4) {\r\n          newPath = [path[0], path[1], path[2] + 1];\r\n\r\n        } else {\r\n          newPath = [path[0], path[1] + 1];\r\n        }\r\n        // 对左边进行赋值\r\n        newPositiong = {\r\n          anchor: {\r\n            offset: 0,\r\n            path: newPath\r\n          },\r\n          focus: {\r\n            offset: 0,\r\n            path: newPath\r\n          }\r\n        };\r\n\r\n        Transforms.setSelection(editor, newPositiong);\r\n\r\n      });\r\n\r\n\r\n    } else {\r\n\r\n      let fromCut = false;\r\n\r\n      try{ // 处理JSON错误\r\n        fromCut = JSON.parse(textData).fromCut\r\n      }catch(e){\r\n\r\n      }\r\n\r\n      if (slateFragment || fromCut) {\r\n\r\n\r\n        let fragmentData = fromCut ? JSON.parse(textData).fragment : JSON.parse(decodeURIComponent(window.atob(slateFragment)));\r\n\r\n        if (props.isoption) {\r\n\r\n          let newFragmentData: any = [];\r\n\r\n          _.map(fragmentData, (el: any ) => {\r\n            if (el.NumberedList) {\r\n\r\n              _.map(el.children, (el: any) => {\r\n                if (newFragmentData.length === 0) {\r\n                  newFragmentData = _.cloneDeep([el]);\r\n                } else {\r\n                  newFragmentData[0].children = newFragmentData[0].children.concat(el.children);\r\n                }\r\n              });\r\n            } else {\r\n\r\n              if (newFragmentData.length === 0) {\r\n                newFragmentData = _.cloneDeep([el]);\r\n              } else {\r\n                newFragmentData[0].children = newFragmentData[0].children.concat(el.children);\r\n              }\r\n            }\r\n          });\r\n          Transforms.insertFragment(editor, newFragmentData);\r\n\r\n        } else {\r\n          const isNumberedList = fragmentData.filter((fragment: any) => fragment.NumberedList).length\r\n          if (isNumberedList || fromCut) {\r\n            if (\r\n              editor.selection.anchor.offset === 0 &&\r\n              editor.selection.anchor.path\r\n                .reduce((reduce: number, path: any) => reduce + path, 0) === 0\r\n            ) {\r\n              Transforms.removeNodes(editor, editor.selection);\r\n            }\r\n            Transforms.insertNodes(editor, fragmentData);\r\n          } else {\r\n            insertData(data);\r\n          }\r\n        }\r\n      } else {\r\n        insertData(data);\r\n      }\r\n    }\r\n  };\r\n\r\n  return editor;\r\n};\r\n\r\n\r\nexport default RichText;\r\n"]}]}